<figure>
<img
src="https://raw.githubusercontent.com/libuv/libuv/master/img/banner.png"
alt="libuv" />
<figcaption aria-hidden="true">libuv</figcaption>
</figure>
<h2 id="overview">Overview</h2>
<p>libuv is a multi-platform support library with a focus on
asynchronous I/O. It was primarily developed for use by <a
href="http://nodejs.org/">Node.js</a>, but it’s also used by <a
href="http://luvit.io/">Luvit</a>, <a
href="http://julialang.org/">Julia</a>, <a
href="https://github.com/MagicStack/uvloop">uvloop</a>, and <a
href="https://github.com/libuv/libuv/blob/v1.x/LINKS.md">others</a>.</p>
<h2 id="feature-highlights">Feature highlights</h2>
<ul>
<li><p>Full-featured event loop backed by epoll, kqueue, IOCP, event
ports.</p></li>
<li><p>Asynchronous TCP and UDP sockets</p></li>
<li><p>Asynchronous DNS resolution</p></li>
<li><p>Asynchronous file and file system operations</p></li>
<li><p>File system events</p></li>
<li><p>ANSI escape code controlled TTY</p></li>
<li><p>IPC with socket sharing, using Unix domain sockets or named pipes
(Windows)</p></li>
<li><p>Child processes</p></li>
<li><p>Thread pool</p></li>
<li><p>Signal handling</p></li>
<li><p>High resolution clock</p></li>
<li><p>Threading and synchronization primitives</p></li>
</ul>
<h2 id="versioning">Versioning</h2>
<p>Starting with version 1.0.0 libuv follows the <a
href="http://semver.org/">semantic versioning</a> scheme. The API change
and backwards compatibility rules are those indicated by SemVer. libuv
will keep a stable ABI across major releases.</p>
<p>The ABI/API changes can be tracked <a
href="http://abi-laboratory.pro/tracker/timeline/libuv/">here</a>.</p>
<h2 id="licensing">Licensing</h2>
<p>libuv is licensed under the MIT license. Check the <a
href="LICENSE">LICENSE</a> and <a href="LICENSE-extra">LICENSE-extra</a>
files.</p>
<p>The documentation is licensed under the CC BY 4.0 license. Check the
<a href="LICENSE-docs">LICENSE-docs file</a>.</p>
<h2 id="community">Community</h2>
<ul>
<li><a
href="https://github.com/libuv/libuv/discussions">Support</a></li>
<li><a href="http://groups.google.com/group/libuv">Mailing list</a></li>
</ul>
<h2 id="documentation">Documentation</h2>
<h3 id="official-documentation">Official documentation</h3>
<p>Located in the docs/ subdirectory. It uses the <a
href="http://sphinx-doc.org/">Sphinx</a> framework, which makes it
possible to build the documentation in multiple formats.</p>
<p>Show different supported building options:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> make help</span></code></pre></div>
<p>Build documentation as HTML:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> make html</span></code></pre></div>
<p>Build documentation as HTML and live reload it when it changes (this
requires sphinx-autobuild to be installed and is only supported on
Unix):</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> make livehtml</span></code></pre></div>
<p>Build documentation as man pages:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> make man</span></code></pre></div>
<p>Build documentation as ePub:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> make epub</span></code></pre></div>
<p>NOTE: Windows users need to use make.bat instead of plain ‘make’.</p>
<p>Documentation can be browsed online <a
href="http://docs.libuv.org">here</a>.</p>
<p>The <a href="https://github.com/libuv/libuv/tree/master/test">tests
and benchmarks</a> also serve as API specification and usage
examples.</p>
<h3 id="other-resources">Other resources</h3>
<ul>
<li><a href="http://www.youtube.com/watch?v=nGn60vDSxQ4">LXJS 2012
talk</a> — High-level introductory talk about libuv.</li>
<li><a href="https://github.com/thlorenz/libuv-dox">libuv-dox</a> —
Documenting types and methods of libuv, mostly by reading uv.h.</li>
<li><a href="https://github.com/thlorenz/learnuv">learnuv</a> — Learn uv
for fun and profit, a self guided workshop to libuv.</li>
</ul>
<p>These resources are not handled by libuv maintainers and might be out
of date. Please verify it before opening new issues.</p>
<h2 id="downloading">Downloading</h2>
<p>libuv can be downloaded either from the <a
href="https://github.com/libuv/libuv">GitHub repository</a> or from the
<a href="http://dist.libuv.org/dist/">downloads site</a>.</p>
<p>Before verifying the git tags or signature files, importing the
relevant keys is necessary. Key IDs are listed in the <a
href="https://github.com/libuv/libuv/blob/master/MAINTAINERS.md">MAINTAINERS</a>
file, but are also available as git blob objects for easier use.</p>
<p>Importing a key the usual way:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> gpg <span class="at">--keyserver</span> pool.sks-keyservers.net <span class="at">--recv-keys</span> AE9BC059</span></code></pre></div>
<p>Importing a key from a git blob object:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> git show pubkey-saghul <span class="kw">|</span> <span class="ex">gpg</span> <span class="at">--import</span></span></code></pre></div>
<h3 id="verifying-releases">Verifying releases</h3>
<p>Git tags are signed with the developer’s key, they can be verified as
follows:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> git verify-tag v1.6.1</span></code></pre></div>
<p>Starting with libuv 1.7.0, the tarballs stored in the <a
href="http://dist.libuv.org/dist/">downloads site</a> are signed and an
accompanying signature file sit alongside each. Once both the release
tarball and the signature file are downloaded, the file can be verified
as follows:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> gpg <span class="at">--verify</span> libuv-1.7.0.tar.gz.sign</span></code></pre></div>
<h2 id="build-instructions">Build Instructions</h2>
<p>For UNIX-like platforms, including macOS, there are two build
methods: autotools or <a href="https://cmake.org/">CMake</a>.</p>
<p>For Windows, <a href="https://cmake.org/">CMake</a> is the only
supported build method and has the following prerequisites:</p>
<details>
<ul>
<li>One of:
<ul>
<li><a
href="https://visualstudio.microsoft.com/visual-cpp-build-tools/">Visual
C++ Build Tools</a></li>
<li><a href="https://www.visualstudio.com/vs/older-downloads/">Visual
Studio 2015 Update 3</a>, all editions including the Community edition
(remember to select “Common Tools for Visual C++ 2015” feature during
installation).</li>
<li><a href="https://www.visualstudio.com/downloads/">Visual Studio
2017</a>, any edition (including the Build Tools SKU). <strong>Required
Components:</strong> “MSbuild”, “VC++ 2017 v141 toolset” and one of the
Windows SDKs (10 or 8.1).</li>
</ul></li>
<li>Basic Unix tools required for some tests, <a
href="http://git-scm.com/download/win">Git for Windows</a> includes Git
Bash and tools which can be included in the global
<code>PATH</code>.</li>
</ul>
</details>
<p>To build with autotools:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sh autogen.sh</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./configure</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> make</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> make check</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> make install</span></code></pre></div>
<p>To build with <a href="https://cmake.org/">CMake</a>:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mkdir <span class="at">-p</span> build</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> <span class="er">(</span><span class="bu">cd</span> build <span class="kw">&amp;&amp;</span> <span class="fu">cmake</span> .. <span class="at">-DBUILD_TESTING</span><span class="op">=</span>ON<span class="kw">)</span> <span class="co"># generate project with tests</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cmake <span class="at">--build</span> build                       <span class="co"># add `-j &lt;n&gt;` with cmake &gt;= 3.12</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Run tests:</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> <span class="er">(</span><span class="bu">cd</span> build <span class="kw">&amp;&amp;</span> <span class="ex">ctest</span> <span class="at">-C</span> Debug <span class="at">--output-on-failure</span><span class="kw">)</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Or manually run tests:</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> build/uv_run_tests                        <span class="co"># shared library build</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> build/uv_run_tests_a                      <span class="co"># static library build</span></span></code></pre></div>
<p>To cross-compile with <a href="https://cmake.org/">CMake</a>
(unsupported but generally works):</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cmake ../..                 <span class="dt">\</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">-DCMAKE_SYSTEM_NAME</span><span class="op">=</span>Windows <span class="dt">\</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">-DCMAKE_SYSTEM_VERSION</span><span class="op">=</span>6.1  <span class="dt">\</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">-DCMAKE_C_COMPILER</span><span class="op">=</span>i686-w64-mingw32-gcc</span></code></pre></div>
<h3 id="install-with-homebrew">Install with Homebrew</h3>
<div class="sourceCode" id="cb13"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> brew install <span class="at">--HEAD</span> libuv</span></code></pre></div>
<p>Note to OS X users:</p>
<p>Make sure that you specify the architecture you wish to build for in
the “ARCHS” flag. You can specify more than one by delimiting with a
space (e.g. “x86_64 i386”).</p>
<h3 id="install-with-vcpkg">Install with vcpkg</h3>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> git clone https://github.com/microsoft/vcpkg.git</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./bootstrap-vcpkg.bat <span class="co"># for powershell</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./bootstrap-vcpkg.sh <span class="co"># for bash</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./vcpkg install libuv</span></code></pre></div>
<h3 id="running-tests">Running tests</h3>
<p>Some tests are timing sensitive. Relaxing test timeouts may be
necessary on slow or overloaded machines:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> env UV_TEST_TIMEOUT_MULTIPLIER=2 build/uv_run_tests <span class="co"># 10s instead of 5s</span></span></code></pre></div>
<h4 id="run-one-test">Run one test</h4>
<p>The list of all tests is in <code>test/test-list.h</code>.</p>
<p>This invocation will cause the test driver to fork and execute
<code>TEST_NAME</code> in a child process:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> build/uv_run_tests_a TEST_NAME</span></code></pre></div>
<p>This invocation will cause the test driver to execute the test in the
same process:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> build/uv_run_tests_a TEST_NAME TEST_NAME</span></code></pre></div>
<h4 id="debugging-tools">Debugging tools</h4>
<p>When running the test from within the test driver process
(<code>build/uv_run_tests_a TEST_NAME TEST_NAME</code>), tools like gdb
and valgrind work normally.</p>
<p>When running the test from a child of the test driver process
(<code>build/uv_run_tests_a TEST_NAME</code>), use these tools in a
fork-aware manner.</p>
<h5 id="fork-aware-gdb">Fork-aware gdb</h5>
<p>Use the <a
href="https://sourceware.org/gdb/onlinedocs/gdb/Forks.html">follow-fork-mode</a>
setting:</p>
<pre><code>$ gdb --args build/uv_run_tests_a TEST_NAME

(gdb) set follow-fork-mode child
...</code></pre>
<h5 id="fork-aware-valgrind">Fork-aware valgrind</h5>
<p>Use the <code>--trace-children=yes</code> parameter:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> valgrind <span class="at">--trace-children</span><span class="op">=</span>yes <span class="at">-v</span> <span class="at">--tool</span><span class="op">=</span>memcheck <span class="at">--leak-check</span><span class="op">=</span>full <span class="at">--track-origins</span><span class="op">=</span>yes <span class="at">--leak-resolution</span><span class="op">=</span>high <span class="at">--show-reachable</span><span class="op">=</span>yes <span class="at">--log-file</span><span class="op">=</span>memcheck-%p.log build/uv_run_tests_a TEST_NAME</span></code></pre></div>
<h3 id="running-benchmarks">Running benchmarks</h3>
<p>See the section on running tests. The benchmark driver is
<code>./uv_run_benchmarks_a</code> and the benchmarks are listed in
<code>test/benchmark-list.h</code>.</p>
<h2 id="supported-platforms">Supported Platforms</h2>
<p>Check the <a href="SUPPORTED_PLATFORMS.md">SUPPORTED_PLATFORMS
file</a>.</p>
<h3 id="fno-strict-aliasing"><code>-fno-strict-aliasing</code></h3>
<p>It is recommended to turn on the <code>-fno-strict-aliasing</code>
compiler flag in projects that use libuv. The use of ad hoc
“inheritance” in the libuv API may not be safe in the presence of
compiler optimizations that depend on strict aliasing.</p>
<p>MSVC does not have an equivalent flag but it also does not appear to
need it at the time of writing (December 2019.)</p>
<h3 id="aix-notes">AIX Notes</h3>
<p>AIX compilation using IBM XL C/C++ requires version 12.1 or
greater.</p>
<p>AIX support for filesystem events requires the non-default IBM
<code>bos.ahafs</code> package to be installed. This package provides
the AIX Event Infrastructure that is detected by <code>autoconf</code>.
<a
href="http://www.ibm.com/developerworks/aix/library/au-aix_event_infrastructure/">IBM
documentation</a> describes the package in more detail.</p>
<h3 id="zos-notes">z/OS Notes</h3>
<p>z/OS compilation requires <a
href="https://github.com/ibmruntimes/zoslib">ZOSLIB</a> to be installed.
When building with <a href="https://cmake.org/">CMake</a>, use the flag
<code>-DZOSLIB_DIR</code> to specify the path to <a
href="https://github.com/ibmruntimes/zoslib">ZOSLIB</a>:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> <span class="er">(</span><span class="bu">cd</span> build <span class="kw">&amp;&amp;</span> <span class="fu">cmake</span> .. <span class="at">-DBUILD_TESTING</span><span class="op">=</span>ON <span class="at">-DZOSLIB_DIR</span><span class="op">=</span>/path/to/zoslib<span class="kw">)</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cmake <span class="at">--build</span> build</span></code></pre></div>
<p>z/OS creates System V semaphores and message queues. These persist on
the system after the process terminates unless the event loop is
closed.</p>
<p>Use the <code>ipcrm</code> command to manually clear up System V
resources.</p>
<h2 id="patches">Patches</h2>
<p>See the <a
href="https://github.com/libuv/libuv/blob/master/CONTRIBUTING.md">guidelines
for contributing</a>.</p>
