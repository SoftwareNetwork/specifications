<h1 id="mainpage">The FastCGI implementation on modern C++</h1>
<p>The implementation is aimed to be as simple as possible (maybe even &quot;dumb&quot;) for better understanding and correctness.</p>
<p><strong>ATTENTION, this software is &quot;beta&quot; quality, and the API is a subject to change!</strong></p>
<p>Any <a href="mailto:dmitigr@gmail.com">feedback</a> (<em>especially results of testing</em>) is highly appreciated!</p>
<p>Please note, there are <a href="http://dmitigr.ru/en/projects/fcgi/doc/">official Dmitigr Fcgi documentation site</a>. Because of the Dmitigr Fcgi documentation is generated by <a href="http://doxygen.org/">Doxygen</a>, most of references to the classes and methods on the official documentation site are clickable, which makes the familiarization more convenient. Also there are <a href="http://dmitigr.ru/en/projects/fcgi/doc/overview.class.violet.html">overview class diagram</a> of the API for better understanding.</p>
<h1 id="features">Features</h1>
<p>Reliable and fast implementation of the FastCGI protocol.</p>
<ul>
<li>Easy to use API;</li>
<li>High performance;</li>
<li>Can be used as shared, static or &quot;header-only&quot; library.</li>
</ul>
<h1 id="hello-world">Hello, World</h1>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="pp">#include </span><span class="im">&lt;dmitigr/fcgi.hpp&gt;</span>

<span class="pp">#include </span><span class="im">&lt;iostream&gt;</span>

<span class="dt">int</span> main(<span class="dt">int</span>, <span class="dt">char</span>**)
{
  <span class="kw">namespace</span> fcgi = dmitigr::fcgi;
  <span class="cf">try</span> {
    <span class="at">const</span> <span class="kw">auto</span> port = <span class="dv">9000</span>;
    <span class="at">const</span> <span class="kw">auto</span> backlog = <span class="dv">64</span>;
    <span class="at">const</span> <span class="kw">auto</span> server = fcgi::Listener_options::make(<span class="st">&quot;0.0.0.0&quot;</span>, port, backlog)-&gt;make_listener();
    server-&gt;listen();
    <span class="cf">while</span> (<span class="kw">true</span>) {
      <span class="cf">if</span> (<span class="at">const</span> <span class="kw">auto</span> conn = server-&gt;accept()) {
        conn-&gt;out() &lt;&lt; <span class="st">&quot;Content-Type: text/plain&quot;</span> &lt;&lt; fcgi::crlfcrlf;
        conn-&gt;out() &lt;&lt; <span class="st">&quot;Hello from dmitigr::fcgi!&quot;</span>;
      }
    }
  } <span class="cf">catch</span> (<span class="at">const</span> <span class="bu">std::</span>exception&amp; e) {
    <span class="bu">std::</span>cerr &lt;&lt; <span class="st">&quot;Oops: &quot;</span> &lt;&lt; e.what() &lt;&lt; <span class="bu">std::</span>endl;
    <span class="cf">return</span> <span class="dv">1</span>;
  }
  <span class="cf">return</span> <span class="dv">0</span>;
}</code></pre></div>
<h1 id="hello-multithreaded-world">Hello, Multithreaded World</h1>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="pp">#include </span><span class="im">&lt;dmitigr/fcgi.hpp&gt;</span>

<span class="pp">#include </span><span class="im">&lt;iostream&gt;</span>
<span class="pp">#include </span><span class="im">&lt;thread&gt;</span>
<span class="pp">#include </span><span class="im">&lt;vector&gt;</span>

<span class="kw">namespace</span> {

<span class="kw">constexpr</span> <span class="bu">std::</span>size_t pool_size = <span class="dv">64</span>;

} <span class="co">// namespace</span>

<span class="dt">int</span> main(<span class="dt">int</span>, <span class="dt">char</span>**)
{
  <span class="kw">namespace</span> fcgi = dmitigr::fcgi;
  <span class="cf">try</span> {
    <span class="at">const</span> <span class="kw">auto</span> serve = [](<span class="kw">auto</span>* <span class="at">const</span> server)
    {
      <span class="cf">while</span> (<span class="kw">true</span>) {
        <span class="at">const</span> <span class="kw">auto</span> conn = server-&gt;accept();
        conn-&gt;out() &lt;&lt; <span class="st">&quot;Content-Type: text/plain&quot;</span> &lt;&lt; fcgi::crlfcrlf;
        conn-&gt;out() &lt;&lt; <span class="st">&quot;Hello from dmitigr::fcgi!&quot;</span>;
        conn-&gt;close(); <span class="co">// Optional.</span>
      }
    };

    <span class="at">const</span> <span class="kw">auto</span> port = <span class="dv">9000</span>;
    <span class="at">const</span> <span class="kw">auto</span> backlog = <span class="dv">64</span>;
    <span class="bu">std::</span>clog &lt;&lt; <span class="st">&quot;Multi-threaded FastCGI server started:</span><span class="sc">\n</span><span class="st">&quot;</span>
              &lt;&lt; <span class="st">&quot;  port = &quot;</span> &lt;&lt; port &lt;&lt; <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>
              &lt;&lt; <span class="st">&quot;  backlog = &quot;</span> &lt;&lt; backlog &lt;&lt; <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>
              &lt;&lt; <span class="st">&quot;  thread pool size = &quot;</span> &lt;&lt; pool_size &lt;&lt; <span class="bu">std::</span>endl;

    <span class="at">const</span> <span class="kw">auto</span> server = fcgi::Listener_options::make(<span class="st">&quot;0.0.0.0&quot;</span>, port, backlog)-&gt;make_listener();
    server-&gt;listen();
    <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>thread&gt; threads(pool_size);
    <span class="cf">for</span> (<span class="kw">auto</span>&amp; t : threads)
      t = <span class="bu">std::</span>thread{serve, server.get()};

    <span class="cf">for</span> (<span class="kw">auto</span>&amp; t : threads)
      t.join();

    server-&gt;close(); <span class="co">// Optional.</span>
  } <span class="cf">catch</span> (<span class="at">const</span> <span class="bu">std::</span>exception&amp; e) {
    <span class="bu">std::</span>cerr &lt;&lt; <span class="st">&quot;error: &quot;</span> &lt;&lt; e.what() &lt;&lt; <span class="bu">std::</span>endl;
    <span class="cf">return</span> <span class="dv">1</span>;
  } <span class="cf">catch</span> (...) {
    <span class="bu">std::</span>cerr &lt;&lt; <span class="st">&quot;unknown error&quot;</span> &lt;&lt; <span class="bu">std::</span>endl;
    <span class="cf">return</span> <span class="dv">2</span>;
  }
  <span class="cf">return</span> <span class="dv">0</span>;
}</code></pre></div>
<h1 id="tutorial">Tutorial</h1>
<p>Client programs that use Dmitigr Fcgi must include header file <code>dmitigr/fcgi.hpp</code>. and must link with <code>dmitigr_fcgi</code> (or the debug build - <code>dmitigr_fcgid</code>) if Dmitigr Fcgi is used as a regular library. (There is no need in linkage if the header-only version is used.)</p>
<p><strong>WARNING</strong> Headers other than <code>dmitigr/fcgi.hpp</code> should be <em>avoided</em> to use in applications since that headers are subject to reorganize. Also the namespace <code>dmitigr::fcgi::detail</code> consists of the implementation details and <em>should not</em> be used in the client code.</p>
<h1 id="download">Download</h1>
<p>The Dmitigr Fcgi repository is located at Github <a href="https://github.com/dmitigr/fcgi.git">here</a>.</p>
<h1 id="installation-and-consuming">Installation and consuming</h1>
<h2 id="dependencies">Dependencies</h2>
<ul>
<li><a href="https://cmake.org/">CMake</a> build system version 3.13+;</li>
<li>C++17 compiler (<a href="https://gcc.gnu.org/">GCC</a> 7.3+ or <a href="https://www.visualstudio.com/">Microsoft Visual C++</a> 15.7+);</li>
<li><a href="https://github.com/dmitigr/common.git">dmitigr_common</a> library.</li>
</ul>
<h2 id="build-time-settings">Build time settings</h2>
<p>Settings that may be specified at build time by using <a href="https://cmake.org/">CMake</a> variables are: 1. the type of the build (only meaningful to single-configuration generators); 2. the flag to build the shared library (default is on); 3. the flag to only install the header-only library (default is off); 4. the flag to build the tests (default is on); 5. installation directories.</p>
<p>Details:</p>
<table style="width:92%;">
<colgroup>
<col width="20%" />
<col width="22%" />
<col width="22%" />
<col width="26%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">CMake variable</th>
<th align="left">Possible values</th>
<th align="left">Default on Unix</th>
<th align="left">Default on Windows</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>The type of the build</strong></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">CMAKE_BUILD_TYPE</td>
<td align="left">Debug | Release | RelWithDebInfo | MinSizeRel</td>
<td align="left">Debug</td>
<td align="left">Debug</td>
</tr>
<tr class="odd">
<td align="left"><strong>The flag to build the shared library</strong></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">BUILD_SHARED_LIBS</td>
<td align="left">On | Off</td>
<td align="left">On</td>
<td align="left">On</td>
</tr>
<tr class="odd">
<td align="left"><strong>The flag to only install the header-only library</strong></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">DMITIGR_FCGI_HEADER_ONLY</td>
<td align="left">On | Off</td>
<td align="left">Off</td>
<td align="left">Off</td>
</tr>
<tr class="odd">
<td align="left"><strong>The flag of building the tests</strong></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">DMITIGR_FCGI_BUILD_TESTS</td>
<td align="left">On | Off</td>
<td align="left">On</td>
<td align="left">On</td>
</tr>
<tr class="odd">
<td align="left"><strong>Installation directories</strong></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">CMAKE_INSTALL_PREFIX</td>
<td align="left"><em>an absolute path</em></td>
<td align="left">&quot;/usr/local&quot;</td>
<td align="left">&quot;%ProgramFiles%_fcgi&quot;</td>
</tr>
<tr class="odd">
<td align="left">DMITIGR_FCGI_CMAKE_INSTALL_DIR</td>
<td align="left"><em>a path relative to CMAKE_INSTALL_PREFIX</em></td>
<td align="left">&quot;share/dmitigr_fcgi/cmake&quot;</td>
<td align="left">&quot;cmake&quot;</td>
</tr>
<tr class="even">
<td align="left">DMITIGR_FCGI_DOC_INSTALL_DIR</td>
<td align="left"><em>a path relative to CMAKE_INSTALL_PREFIX</em></td>
<td align="left">&quot;share/dmitigr_fcgi/doc&quot;</td>
<td align="left">&quot;doc&quot;</td>
</tr>
<tr class="odd">
<td align="left">DMITIGR_FCGI_LIB_INSTALL_DIR</td>
<td align="left"><em>a path relative to CMAKE_INSTALL_PREFIX</em></td>
<td align="left">&quot;lib&quot;</td>
<td align="left">&quot;lib&quot;</td>
</tr>
<tr class="even">
<td align="left">DMITIGR_FCGI_INCLUDE_INSTALL_DIR</td>
<td align="left"><em>a path relative to CMAKE_INSTALL_PREFIX</em></td>
<td align="left">&quot;include&quot;</td>
<td align="left">&quot;include&quot;</td>
</tr>
</tbody>
</table>
<h2 id="installation-in-common">Installation in common</h2>
<p>Dmitigr Fcgi is depends on <a href="https://github.com/dmitigr/common.git">dmitigr_common</a>.</p>
<p><strong>WARNING</strong> It's highly recommended to update the <a href="https://github.com/dmitigr/common.git">dmitigr_common</a> library (just pull and reinstall) before every build of the Dmitigr Fcgi library!</p>
<h2 id="installation-on-linux">Installation on Linux</h2>
<pre><code>$ git clone https://github.com/dmitigr/fcgi.git
$ mkdir -p fcgi/build
$ cd fcgi/build
$ cmake -DCMAKE_BUILD_TYPE=Debug ..
$ make
$ sudo make install</code></pre>
<h2 id="installation-on-microsoft-windows">Installation on Microsoft Windows</h2>
<p>Run the Developer Command Prompt for Visual Studio and type:</p>
<pre><code>&gt; git clone https://github.com/dmitigr/fcgi.git
&gt; mkdir fcgi\build
&gt; cd fcgi\build
&gt; cmake -G &quot;Visual Studio 15 2017 Win64&quot; ..
&gt; cmake --build . --config Debug</code></pre>
<p>Next, run the Elevated Command Prompt (i.e. the command prompt with administrator privileges) and type:</p>
<pre><code>&gt; cd fcgi\build
&gt; cmake -DBUILD_TYPE=Debug -P cmake_install.cmake</code></pre>
<p>To make the installed DLL available for <em>any</em> application that depends on it, the symbolic link to the dmitigr_fcgi.dll (or to the debug version - dmitigr_fcgid.dll) should be created:</p>
<ul>
<li>in %SYSTEMROOT%\System32 for the 64-bit DLL on 64-bit host (or for 32-bit DLL on 32-bit host);</li>
<li>in %SYSTEMROOT%\SysWOW64 for the 32-bit DLL on 64-bit host.</li>
</ul>
<p>To create the symbolic link run the Elevated Command Prompt and use <code>mklink</code> command, for example:</p>
<pre><code>&gt; cd /d %SYSTEMROOT%\System32
&gt; mklink dmitigr_fcgid.dll &quot;%ProgramFiles%\dmitigr_fcgi\lib\dmitigr_fcgid.dll&quot;</code></pre>
<h2 id="consuming">Consuming</h2>
<p>If you are using CMake the consuming of the Dmitigr Fcgi library is quite simple. For example:</p>
<div class="sourceCode"><pre class="sourceCode cmake"><code class="sourceCode cmake"><span class="kw">cmake_minimum_required</span>(<span class="ot">VERSION</span> 3.13)
<span class="kw">project</span>(foo)
<span class="kw">find_package</span>(dmitigr_fcgi <span class="ot">REQUIRED</span>) <span class="co"># find shared version of the Dmitigr Fcgi library</span>
<span class="kw">set</span>(<span class="va">CMAKE_CXX_STANDARD</span> 17)
<span class="kw">set</span>(<span class="ot">CXX_STANDARD_REQUIRED</span> <span class="ot">ON</span>)
<span class="kw">add_executable</span>(foo foo.cpp)
<span class="kw">target_link_libraries</span>(foo dmitigr_fcgi)</code></pre></div>
<p>The above code snippet is minimal CMakeLists.txt that enough to build the application <code>foo</code> that depends on the Dmitigr Fcgi library.</p>
<p>To consume the header-only version of the Dmitigr Fcgi library just specify it by using <code>CONFIGS</code> option of <a href="https://cmake.org/cmake/help/latest/command/find_package.html">find_package</a>:</p>
<div class="sourceCode"><pre class="sourceCode cmake"><code class="sourceCode cmake"><span class="kw">find_package</span>(dmitigr_fcgi <span class="ot">REQUIRED</span> <span class="ot">CONFIGS</span> dmitigr_fcgi_interface-config.cmake)
<span class="co"># ...</span>
<span class="kw">target_link_libraries</span>(foo dmitigr_fcgi_interface)</code></pre></div>
<h1 id="license">License</h1>
<p>Dmitigr Fcgi is distributed under zlib license. For conditions of distribution and use, see file <code>LICENSE.txt</code>.</p>
<h1 id="donations">Donations</h1>
<p>Dmitigr Fcgi has been developed on the own funds. Donations are welcome! To make a donation, please go <a href="https://paypal.me/dmitigr">here</a>.</p>
<h1 id="feedback">Feedback</h1>
<p>Any feedback are welcome. <a href="mailto:dmitigr@gmail.com">Contact us</a>.</p>
<h1 id="copyright">Copyright</h1>
<p>Copyright (C) Dmitry Igrishin</p>
