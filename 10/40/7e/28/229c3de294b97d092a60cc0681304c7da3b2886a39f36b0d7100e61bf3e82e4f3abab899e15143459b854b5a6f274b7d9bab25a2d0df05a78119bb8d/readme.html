<h1 id="tiny-usdzusdausdc-library-in-c14">Tiny USDZ/USDA/USDC library in
C++14</h1>
<p><code>TinyUSDZ</code> is secure, portable and dependency-free(depends
only on C++ STL. Other 3rd-party libraries included. Yes, you don’t need
pxrUSD/OpenUSD library!) USDZ/USDC/USDA library written in C++14.</p>
<p><a href="https://lighttransport.github.io/tinyusdz/index.html">Wasm
demo!</a> (requires 10MB file download)</p>
<p><img src="https://github.com/syoyo/tinyusdz/assets/18676/2419ddf6-4410-4bcc-b9c1-466bf29d3b20" width="400px">
(from https://github.com/syoyo/Vulkan-glTF-USDZ-PBR)</p>
<p><img src="https://github.com/lighttransport/tinyusdz/assets/18676/5291f44f-b20a-4d4a-9b4a-16ffefccddc7" width="400px">
(from ASF MaterialXViewer fork
https://github.com/lighttransport/materialx)</p>
<h2 id="high-priority">High priority</h2>
<ul>
<li>Prepare Release v0.8
<ul>
<li><label><input type="checkbox" checked="" />Core part should be ready
for the release.</label></li>
<li><label><input type="checkbox" />Write a demo and example viewer(work
in progress)</label>
<ul>
<li><a href="examples/openglviewer">examples/openglviewer</a> OpenGL
viewer</li>
<li><a href="examples/sdlviewer">examples/sdlviewer</a> Software
raytracing viewer</li>
</ul></li>
<li>For Vulkan and Android Vulkan example, please refer
https://github.com/syoyo/Vulkan-glTF-USDZ-PBR for a while</li>
<li>For OpenGL + MaterialX example, please refer ASF MaterialXViewer
fork to load USD model through TinyUSDZ
https://github.com/lighttransport/materialx</li>
</ul></li>
</ul>
<h2 id="mid-term-todo">Mid-term todo</h2>
<ul>
<li>Performace optimization
https://github.com/syoyo/tinyusdz/issues/164</li>
<li>MaterialX https://github.com/syoyo/tinyusdz/issues/86
<ul>
<li>Write our own MaterialX parser</li>
<li>OpenPBR shading model support
https://github.com/lighttransport/tinyusdz/issues/172</li>
<li>USD + MateriralX + OpenPBR rendering verification using pbrlab?
https://github.com/lighttransport/pbrlab</li>
</ul></li>
<li>Nested variantSet
https://github.com/lighttransport/tinyusdz/issues/94</li>
<li>Enhancement for wasm, webgpu
https://github.com/syoyo/tinyusdz/issues/118
<ul>
<li>Three.js loader addon(TinyUSDZLoader)
https://github.com/lighttransport/tinyusdz/issues/185</li>
</ul></li>
<li>better colorspace + wide-gamut support
https://github.com/syoyo/tinyusdz/issues/142</li>
<li>Better skinning + blendshapes support
<ul>
<li>Write example using mediapipe for motion tracking and face tracking
with rigged USDZ model.<br />
</li>
</ul></li>
<li>Improve interoperability with Blender USD export/import
https://github.com/syoyo/tinyusdz/issues/98</li>
<li>Tydra: Handy data structure converter for rendering
https://github.com/syoyo/tinyusdz/issues/31
<ul class="task-list">
<li><label><input type="checkbox" checked="" />USD to
RenderScene(OpenGL/Vulkan-like API friendly data structure) conversion
https://github.com/syoyo/tinyusdz/issues/109</label></li>
<li><label><input type="checkbox" checked="" />GeomSubset/Material
Binding API support for shading/texturing
https://github.com/syoyo/tinyusdz/issues/103</label></li>
</ul></li>
<li><label><input type="checkbox" checked="" />UTF8 Identifier support
https://github.com/syoyo/tinyusdz/issues/47</label></li>
<li>Collection API
<ul class="task-list">
<li><label><input
type="checkbox" />https://github.com/syoyo/tinyusdz/issues/108</label></li>
</ul></li>
<li>Experimental composition support
https://github.com/syoyo/tinyusdz/issues/25
<ul class="task-list">
<li><label><input type="checkbox" checked="" />subLayers</label></li>
<li><label><input type="checkbox" checked="" />references</label></li>
<li><label><input type="checkbox" checked="" />payload(no delayed
load)</label></li>
<li><label><input type="checkbox" checked="" />inherits</label></li>
<li><label><input type="checkbox" checked="" />variantSet</label></li>
<li><label><input type="checkbox" />Validate composition is correctly
operated.</label></li>
</ul></li>
<li>Better usdLux support
https://github.com/syoyo/tinyusdz/issues/101</li>
<li><label><input type="checkbox" />Support parsing usd-wg USD
aasets</label>
<ul>
<li>https://github.com/syoyo/tinyusdz/issues/135</li>
</ul></li>
<li>Support reading &amp; compose some production USD scenes
<ul class="task-list">
<li><label><input type="checkbox" />Moana island v2.1
https://github.com/syoyo/tinyusdz/issues/90</label></li>
<li><label><input type="checkbox" />ALAB USD production scene
https://github.com/syoyo/tinyusdz/issues/91</label></li>
<li><label><input type="checkbox" />Activision Caldera scene
https://github.com/lighttransport/tinyusdz/issues/184</label></li>
</ul></li>
</ul>
<h2 id="build-status">Build status</h2>
<table>
<colgroup>
<col style="width: 7%" />
<col style="width: 35%" />
<col style="width: 32%" />
<col style="width: 9%" />
<col style="width: 6%" />
<col style="width: 7%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: left;">Linux</th>
<th style="text-align: left;">Windows</th>
<th style="text-align: center;">macOS</th>
<th style="text-align: center;">iOS</th>
<th style="text-align: center;">Android</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">dev</td>
<td style="text-align: left;"><a
href="https://github.com/syoyo/tinyusdz/actions/workflows/linux_ci.yml"><img
src="https://github.com/syoyo/tinyusdz/actions/workflows/linux_ci.yml/badge.svg"
alt="Linux Build" /></a></td>
<td style="text-align: left;"><a
href="https://github.com/syoyo/tinyusdz/actions/workflows/windows_ci.yml"><img
src="https://github.com/syoyo/tinyusdz/actions/workflows/windows_ci.yml/badge.svg"
alt="Windows CI build" /></a> </br> <a
href="https://github.com/syoyo/tinyusdz/actions/workflows/windows_arm_ci.yml"><img
src="https://github.com/syoyo/tinyusdz/actions/workflows/windows_arm_ci.yml/badge.svg"
alt="Windows ARM CI build" /></a></td>
<td style="text-align: center;"><a
href="https://github.com/syoyo/tinyusdz/actions/workflows/macos_ci.yml"><img
src="https://github.com/syoyo/tinyusdz/actions/workflows/macos_ci.yml/badge.svg"
alt="macOS Build" /></a></td>
<td style="text-align: center;"><a
href="https://github.com/syoyo/tinyusdz/actions/workflows/ios_ci.yml"><img
src="https://github.com/syoyo/tinyusdz/actions/workflows/ios_ci.yml/badge.svg"
alt="iOS Build" /></a></td>
<td style="text-align: center;"><a
href="https://github.com/syoyo/tinyusdz/actions/workflows/android_ci.yml"><img
src="https://github.com/syoyo/tinyusdz/actions/workflows/android_ci.yml/badge.svg"
alt="Android arm64v8a Build" /></a></td>
</tr>
</tbody>
</table>
<h2 id="supported-platforms">Supported platforms</h2>
<table>
<colgroup>
<col style="width: 5%" />
<col style="width: 25%" />
<col style="width: 23%" />
<col style="width: 6%" />
<col style="width: 4%" />
<col style="width: 5%" />
<col style="width: 19%" />
<col style="width: 8%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: left;">Linux</th>
<th style="text-align: left;">Windows</th>
<th style="text-align: center;">macOS</th>
<th style="text-align: center;">iOS</th>
<th style="text-align: center;">Android</th>
<th style="text-align: center;">WASM(WASI)</th>
<th style="text-align: center;">WASM(Emscripten)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">dev</td>
<td style="text-align: left;">✅ 64bit </br> ✅ 32bit </br> ✅
aarch64</td>
<td style="text-align: left;">✅ 64bit </br> ✅ 32bit </br> ✅
ARM64/ARM32</td>
<td style="text-align: center;">✅</td>
<td style="text-align: center;">✅</td>
<td style="text-align: center;">✅</td>
<td style="text-align: center;">✅ <a
href="sandbox/wasi">sandbox/wasi</a></td>
<td style="text-align: center;">✅ <a
href="sandbox/emscripten">sandbox/emscripten</a></td>
</tr>
</tbody>
</table>
<!--
### Python binding(testing. currently not working)

https://pypi.org/project/tinyusdz/

Python binding is very early alpha testing stage. Not working at the moment.

You can install Python prebuilt wheel using

```
$ python -m pip install tinyusdz
```

|         |   Linux                                  |  Windows                              |   macOS 11(Big Sur) or later  | macos 10  |
|:-------:|:---------------------------------------- |:------------------------------------- |:-----------------------------:|:---------:|
|   3.6(⚠️)   | ✅ 64bit </br> ✅ 32bit </br> ✅ aarch64 | ✅ 64bit </br> ✅ 32bit </br> ✅ ARM64  |🚫 | ✅ Intel |
|   3.7   | ✅ 64bit </br> ✅ 32bit </br> ✅ aarch64 | ✅ 64bit </br> ✅ 32bit </br> ✅ ARM64  |✅ arm64 | 🚫 universal2 </br> ✅ Intel |
|   3.8   | ✅ 64bit </br> ✅ 32bit </br> ✅ aarch64 | ✅ 64bit </br> ✅ 32bit </br> ✅ ARM64  |✅ arm64 | ✅ universal2 </br> ✅ Intel |
|   3.9   | ✅ 64bit </br> ✅ 32bit </br> ✅ aarch64 | ✅ 64bit </br> ✅ 32bit </br> ✅ ARM64  |✅ arm64 | ✅ universal2 </br> ✅ Intel |
|   3.10   | ✅ 64bit </br> ✅ 32bit </br> ✅ aarch64 | ✅ 64bit </br> ✅ 32bit </br> ✅ ARM64  |✅ arm64 | ✅ universal2 </br> ✅ Intel |
|   3.11   | ✅ 64bit </br> ✅ 32bit </br> ✅ aarch64 | ✅ 64bit </br> ✅ 32bit </br> ✅ ARM64  |✅ arm64 | ✅ universal2 </br> ✅ Intel |

⚠️  Python 3.6 is EOL and not recommended to use it. 3.6 bwheels is provided as long as cibuildwheels provides the build for it.
NOTE: Windows ARM64 binary is provided using cross-compiling. Its not well tested.

-->
<h2 id="status">Status</h2>
<p>TinyUSDZ is in v0.8.0 release candidate. Core loading feature(both
USDA and USDC) is now working and production-grade(And no seg fault for
corrupted USDA/USDC/USDZ input). Somewhat working Tydra framwork for
rendering USD model with OpenGL/Vulkan-like renderer.
https://github.com/syoyo/tinyusdz/issues/148</p>
<p>v0.8.0 is basically Flattened scene only(i.e, USDA/USDC generated by
using pxrUSD’s <code>usdcat --flatten</code> or USDZ scene). Composition
features are work-in-progress(experimental Composition feature support
in v0.8.0. Better composition feature in next major release
v0.9.0(Q3/2024 expected) planned)</p>
<p>Remaining tasks for v0.8.0 release are writing examples, demos and
utility functions(Tydra. Especially access to Material/Shader
attributes).</p>
<ul>
<li><label><input type="checkbox" checked="" />USDZ/USDC(Crate)
parser</label>
<ul>
<li>USDC Crate version v0.8.0(most commonly used version as of 2022 Nov)
or higher is supported.</li>
</ul></li>
<li><label><input type="checkbox" />USDZ/USDC(Crate) writer
(Work-in-progress)</label></li>
<li><label><input type="checkbox" checked="" />USDA parser(Hand-written
from a scratch. No Bison/Flex dependency!)</label></li>
<li><label><input type="checkbox" checked="" />USDA writer</label></li>
<li><label><input type="checkbox" checked="" />Support basic
Primitives(Xform, Mesh, BasisCurves, etc.), basic Lights and
Shaders(UsdPreviewSurface, UsdUVTexture, UsdPrimvarReader)</label></li>
<li><strong>Experimental</strong> support of some Composition features
https://github.com/syoyo/tinyusdz/issues/25
<ul class="task-list">
<li><label><input type="checkbox" checked="" />subLayers</label></li>
<li><label><input type="checkbox" checked="" />references</label></li>
<li><label><input type="checkbox" checked="" />payload</label></li>
<li><label><input type="checkbox" checked="" />inherits</label></li>
<li><label><input type="checkbox" checked="" />variants</label></li>
<li><label><input type="checkbox" />specializes</label></li>
</ul></li>
</ul>
<p><strong>Please see</strong> <a href="doc/status.md">doc/status.md</a>
<strong>for more details</strong></p>
<ul class="task-list">
<li><label><input type="checkbox" />Basic C API(<code>c-tinyusd</code>)
for language bindings</label>
<ul class="task-list">
<li><label><input type="checkbox" /><a
href="examples/c_api_example">examples/c_api_example</a></label></li>
<li><label><input type="checkbox" />Basic Python binding</label></li>
</ul></li>
<li><label><input type="checkbox" />Write simple SDL viewer example(2024
Summer expected)</label></li>
<li><label><input type="checkbox" />Write iOS and Android example(2024
Winter expected)</label></li>
<li><label><input type="checkbox" />Write Vision OS
example?</label></li>
<li><label><input type="checkbox" />Vulkan or OptiX/HIP RT raytracing
viewer example</label></li>
<li><label><input type="checkbox" />USD &lt;-&gt; glTF converter
example</label>
<ul>
<li>There is an independent work of USD to glTF binary GLB converter:
https://github.com/fynv/usd2glb</li>
</ul></li>
<li><label><input type="checkbox" />Web demo with Three.js?</label>
<ul class="task-list">
<li><label><input type="checkbox" />Three.js started to support USDZ
with Ascii format, but no USDC support yet:
https://github.com/mrdoob/three.js/issues/14219</label></li>
</ul></li>
</ul>
<h2 id="discussions">Discussions</h2>
<p>We’ve opened Github Discussions page!
https://github.com/syoyo/tinyusdz/discussions</p>
<h3 id="security-and-memory-budget">Security and memory budget</h3>
<p>TinyUSDZ has first priority of considering security and
stability.</p>
<p>USDZ(USDC) is a binary format. To avoid out-of-bounds access,
out-of-memory, and other security issues when loading malcious
USDZ(e.g. USDZ file from unknown origin), TinyUSDZ has a memory budget
feature to avoid out-of-memory issue.</p>
<p>To limit a memory usage when loading USDZ file, Please set a value
<code>max_memory_limit_in_mb</code> in USDLoadOptions.</p>
<p>TinyUSDZ source codes(and some external third party codes) are also
checked by Address Sanitizer, CodeQL and Fuzzer.</p>
<h4 id="fuzzer">Fuzzer</h4>
<p>See <a href="tests/fuzzer">tests/fuzzer</a> . For building fuzzer
tests, you’ll need Meson and Ninja.</p>
<h4 id="web-platformwasm-and-sandboxed-environmentwasi">Web
platform(WASM) and sandboxed environment(WASI)</h4>
<p>If you need to deal with arbitrary USD files from unknown
origin(e.g. from internet, NFT storage. Whose may contain malcious
data), it is recommended to use TinyUSDZ in sandboxed environment(RunC,
FlatPak, WASI(WASM)). Run in WASI is recommended at the moment.</p>
<p>TinyUSDZ does not use C++ exceptions and can be built without
threads. TinyUSDZ supports WASM and WASI build. So TinyUSDZ should runs
well on various Web platform(WebAssembly. No SharedArrayBuffer, Atomics
and WebAssembly SIMD(which is not yet available on iOS Safari) required)
and sandboxed environment(WASI. Users who need to read various USD file
which possibly could contain malcious data from Internet, IPFS or
blockchain storage).</p>
<p>See <a href="sandbox/wasi">sandbox/wasi/</a> for Building TinyUSDZ
with WASI toolchain.</p>
<h3 id="tydra">Tydra</h3>
<p>USD itself is a generic container of 3D scene data.</p>
<p>Tydra is an interface to Renderers/Viewers and other DCCs. Tydra may
be something like Tiny version of pxrUSD Hydra, but its API is
completely different. See <a
href="src/tydra/README.md">src/tydra/README.md</a> for the
background.</p>
<h2 id="notice">Notice</h2>
<p>TinyUSDZ does not support Reality Composer file
format(<code>.reality</code>) since it uses proprietary file format and
we cannot understand it(so no conversion support from/to Reality
also).</p>
<h2 id="sponsorship-and-commercial-support">Sponsorship and Commercial
support</h2>
<p>TinyUSDZ focuses on loading/writing USDA/USDC/USDZ functionalities.
Example viewer is just for demo purpose.</p>
<p>If you need commercial support, eco-system development(e.g. plug-ins,
DCC tools on top of TinyUSDZ) or production-grade USDZ model
viewer(e.g. embed TinyUSDZ to your AR app, 3D NFT Android mobile viewer
capable of displaying (encrypted) USDZ model), please contact Light
Transport Entertainment, Inc. : <a
href="https://forms.gle/PeDRAgYM5ET9SjGs5">https://goo.gl/forms/1p6uGcOKWGpXPHkA2</a></p>
<p>We are also looking for sponsors. If you are interested in
sponsoring(or donating) to TinyUSDZ project, please also contact Light
Transport Entertainment, Inc. for details: <a
href="https://forms.gle/PeDRAgYM5ET9SjGs5">https://goo.gl/forms/1p6uGcOKWGpXPHkA2</a></p>
<h2 id="projects-using-tinyusdz">Projects using TinyUSDZ</h2>
<ul>
<li>Vulkan-glTF-USDZ-PBR: Example to draw USD model using Vulkan
https://github.com/syoyo/Vulkan-glTF-USDZ-PBR</li>
<li>usd2glb: USD to glTF 2.0 GLB converter
https://github.com/fynv/usd2glb</li>
<li>webgpu-cpp-usdz: WebGPU C++/Wasm USDZ Renderer(NOTE: It doesn’t
support much yet!) https://github.com/Twinklebear/webgpu-cpp-usdz</li>
<li>assimp started to integrate TinyUSDZ :
https://github.com/assimp/assimp/pull/5628</li>
<li>A secret project (<em>/ω＼</em>)</li>
<li>Several DCC tools, plugins</li>
<li>Your projects here!(Please send PR)</li>
</ul>
<h3 id="other-related-projects">Other related projects</h3>
<ul>
<li>UsdzSharpie: C# Simple implementation of Usdz file format (
https://github.com/UkooLabs/UsdzSharpie )</li>
<li>TinyGLTF: glTF 2.0 loader/saver ( https://github.com/syoyo/tinygltf
)</li>
</ul>
<h2 id="supported-platforms-1">Supported platforms</h2>
<ul class="task-list">
<li><label><input type="checkbox" checked="" />Linux 64bit or
later</label>
<ul class="task-list">
<li><label><input type="checkbox" checked="" />ARM AARCH64</label></li>
<li><label><input type="checkbox" checked="" />x86-64</label></li>
<li><label><input type="checkbox" />RISC-V(Should work)</label></li>
<li><label><input type="checkbox" />SPARC, POWER(Big endian machine).
May work(theoretically)</label></li>
</ul></li>
<li><label><input type="checkbox" checked="" />Android
arm64v8a</label></li>
<li><label><input type="checkbox" checked="" />iOS</label></li>
<li><label><input type="checkbox" checked="" />macOS(Arm,
x86-64)</label></li>
<li><label><input type="checkbox" checked="" />Windows 10 64bit or
later</label>
<ul class="task-list">
<li><label><input type="checkbox" checked="" />Windows ARM</label></li>
<li><label><input type="checkbox" checked="" />clang-cl + MSVC SDK cross
compile</label></li>
</ul></li>
<li><label><input type="checkbox" checked="" />WebAssembly</label>
<ul>
<li>Emscripten
<ul>
<li>See <a href="examples/sdlviewer">examples/sdlviewer/</a>
example.</li>
</ul></li>
</ul></li>
<li><label><input type="checkbox" checked="" />WASI(through WASI
toolchain)</label>
<ul>
<li>See <a href="sandbox/wasi">sandbox/wasi</a></li>
</ul></li>
</ul>
<h2 id="requirements">Requirements</h2>
<ul>
<li>C++14 compiler
<ul class="task-list">
<li><label><input type="checkbox" checked="" />gcc 4.9 or
later</label></li>
<li><label><input type="checkbox" checked="" />Visual Studio 2019 or
later. 2022 recommended.</label>
<ul>
<li>You can use <code>CMakePresets.json</code>, but seems a bit
troublesome in VS2022
https://github.com/lighttransport/tinyusdz/pull/182#issuecomment-2236676598
. If you encounter an issue, use <code>vcsetup.bat</code> to setup .sln
for a while.</li>
<li><label><input type="checkbox" checked="" />Can be compiled with
standalone MSVC compilers(Build Tools for Visual Studio
2019)</label></li>
</ul></li>
<li><label><input type="checkbox" checked="" />clang 3.4 or later
https://clang.llvm.org/cxx_status.html</label></li>
<li><label><input type="checkbox" checked="" />llvm-mingw(clang)
supported</label></li>
<li><label><input type="checkbox" checked="" />MinGW gcc supported, but
not recommended(You may got compilation failure depending on your build
configuration: https://github.com/syoyo/tinyusdz/issues/33 , and linking
takes too much time if you use default bfd linker.). If you want to
compile TinyUSDZ in MinGW environment, llvm-mingw(clang) is recommended
to use.</label></li>
</ul></li>
</ul>
<p>Compilation with C++17 is also supported. Compile on C++20 and C++23
could be possible, but not well tested, since C++20/C++23 compiler is
not yet mature(as of 2024/01))</p>
<h2 id="build">Build</h2>
<h3 id="integrate-to-your-app">Integrate to your app</h3>
<p>If you are using CMake, just include tinyusdz repo with
<code>add_subdirectory</code> and set include path to
<code>&lt;tinyusdz&gt;/src</code> We recommend to use CMake 3.24 or
later. (Mininum requirement is 3.16)</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode cmake"><code class="sourceCode cmake"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="er">...</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># TinyUSDZ examples, tests and tools builds are disabled by default when</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># tinyusdz is being built as a library with `add_subdirectory`</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">add_subdirectory</span>(/path/to/tinyusdz tinyusdz)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="kw">target_include_directories</span>(<span class="bn">YOUR_APP</span> <span class="ot">PRIVATE</span> <span class="st">&quot;/path/to/tinyusdz/src&quot;</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Namespaced static library target `tinyusdz::tinyusdz_static` is provided.</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># At the moment we recommend to use static build of TinyUSDZ. </span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># You can use alias target `tinyusdz_static` also for legacy cmake version. </span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="kw">target_link_libraries</span>(<span class="bn">YOUR_APP</span> <span class="ot">PRIVATE</span> <span class="bn">tinyusdz::tinyusdz_static</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># For TinyUSDZ DLL(shared) library target, you can use</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># `tinyusdz` library target  </span></span></code></pre></div>
<p>Another way is simply copy <code>src</code> folder to your app, and
add <code>*.cc</code> files to your app’s build system. All include
paths are set relative from <code>src</code> folder, so you can just add
include directory to <code>src</code> folder.</p>
<p>See <code>&lt;tinyusdz&gt;/CMakeLists.txt</code> and <a
href="examples/sdlviewer/CMakeLists.txt">examples/sdlviewer/CMakeLists.txt</a>
for details.</p>
<p>TinyUSDZ does not generate any header files and source files before
the build and after the build(before the installation stage), so you
don’t need to take care of any pre-processing and post-processing of
source tree. For example, USD Ascii parser uses hand-written C++ code so
no Bison/flex/PEG processing involved.</p>
<p>It may not be recommend to use tinyusdz as a git submodule, since the
repo contains lots of codes required to build TinyUSDZ examples but
these are not required for your app.</p>
<h3 id="compiler-defines">Compiler defines</h3>
<p>Please see <code>CMake build options</code> and
<code>CMakeLists.txt</code>. In most case same identifier is defined
from cmake build options: For example if you specify
<code>-DTINYUSDZ_PRODUCTION_BUILD=1</code> for cmake argument,
<code>TINYUSDZ_PRODUCTION_BUILD</code> is defined.</p>
<h3 id="cmake">CMake</h3>
<p>Cmake build is provided.</p>
<h4 id="linux-and-macos">Linux and macOS</h4>
<pre><code>$ mkdir build
$ cd build
$ cmake ..
$ make</code></pre>
<p>Please take a look at <code>scripts/bootstrap-cmake-*.sh</code> for
some build configuraions.</p>
<h4 id="visual-studio">Visual Studio</h4>
<p>Visual Studio 2019 and 2022 are supported.</p>
<p><code>CMakePresets.json</code> is provided for easier build on Visual
Studio 2019 and Visual Studio 2022, but has lot of limitations(and seems
parallel build is not working well so build is slow).</p>
<p>If you want flexibility, ordinary cmake <code>.sln</code> generation
approach by invoking <code>vcsetup.bat</code> recommended. (Edit VS
version in <code>vcsetup.bat</code> as you with before the run)</p>
<h4 id="llvm-mingw-build">LLVM-MinGW build</h4>
<p>MinGW native and cross-compiling example using llvm-mingw(clang) is
provided. See <code>scripts/bootstrap-cmake-mingw-win.sh</code> and
<code>scripts/bootstrap-cmake-llvm-mingw-cross.sh</code> for
details.</p>
<p>One of benefit to use llvm-mingw is address sanitizer support on
Windows app.</p>
<p>To run app(<code>.exe</code>, you’ll need <code>libunwind.dll</code>
and <code>libc++.dll</code> on your working directory or search
path)</p>
<p>For Windows native build, we assume <code>ninja.exe</code> is
installed on your system(You can use it from Meson package)</p>
<h4 id="cmake-build-options">CMake build options</h4>
<ul>
<li><code>TINYUSDZ_PRODUCTION_BUILD</code> : Production build. Do not
output debugging logs.</li>
<li><code>TINYUSDZ_BUILD_TESTS</code> : Build tests</li>
<li><code>TINYUSDZ_BUILD_EXAMPLES</code> : Build examples(note that not
all examples in <code>examples</code> folder are built)</li>
<li><code>TINYUSDZ_WITH_OPENSUBDIV</code> : Use OpenSubviv to tessellate
subdivision surface.
<ul>
<li>OpenSubdiv code is included in TinyUSDZ repo. If you want to use
external OpenSubdiv repo, specity the path to OpenSubdiv using
<code>osd_DIR</code> cmake environment variable.</li>
</ul></li>
<li><code>TINYUSDZ_WITH_AUDIO</code> : Support loading audio(mp3 and
wav).</li>
<li><code>TINYUSDZ_WITH_EXR</code> : Support loading EXR format HDR
texture through TinyEXR.</li>
<li><code>TINYUSDZ_WITH_PXR_COMPAT_API</code> : Build with pxrUSD
compatible API.</li>
</ul>
<h4 id="clang-cl-on-windows">clang-cl on Windows</h4>
<p>Assume ninja.exe is installed and path to ninja.exe is added to your
<code>%PATH%</code></p>
<p>Edit path to MSVC SDK and Windows SDK in
<code>bootstrap-clang-cl-win64.bat</code>, then</p>
<pre><code>&gt; bootstrap-clang-cl-win64.bat
&gt; ninja.exe</code></pre>
<h3 id="tools-and-examples">Tools and Examples</h3>
<ul>
<li><a href="examples/tusdcat/">tusdcat</a> Parse USDZ/USDA/USDC and
print it as Ascii(similar to <code>usdcat</code> in pxrUSD).
<ul>
<li><code>tusdcat</code> also do USD composition(<code>flatten</code>)
and contains TinyUSDZ Composition API usecase.</li>
</ul></li>
<li>Deprecated. Use <code>tusdcat</code> <a
href="examples/usda_parser/">usda_parser</a> Parse USDA and print it as
Ascii.</li>
<li>Deprecated. Use <code>tusdcat</code> <a
href="examples/usdc_parser/">usdc_parser</a> Parse USDC and print it as
Ascii.</li>
<li><a href="examples/sdlviewer/">Simple SDL viewer</a>
<ul>
<li>Separated CMake build provided: See <a
href="examples/sdlviewer/README.md">Readme</a></li>
</ul></li>
<li><a href="examples/api_tutorial/">api_tutorial</a> Tutorial of
TinyUSDZ Core API to construct a USD scene data.</li>
<li><a href="examples/tydra_api/">tydra_api</a> Tutorial of TinyUSDZ
Tydra API to access/query/convert a USD scene data.</li>
<li><a href="examples/asset_resolution/">asset_resolution</a> Tutorial
of using AssetResolutionResolver API to load USD from customized
I/O(e.g. from Memory, Web, DB, …)</li>
<li><a href="examples/file_format/">file_format</a> Tutorial of using
custom FileFormat handler to load Prim data in custom fileformat.</li>
</ul>
<p>See <a href="examples">examples</a> directory for more examples, but
may not actively maintained except for the above examples.</p>
<h4 id="examples-as-external-project">Examples as external project</h4>
<ul>
<li>Vulkan rendering of USDZ model by extending Vulkan-glTF-PBR
https://github.com/syoyo/Vulkan-glTF-USDZ-PBR
<ul>
<li>Uses <code>rendermesh-refactor</code> branch</li>
</ul></li>
</ul>
<h3 id="usdz-data-format">USDZ Data format</h3>
<p>See <a href="doc/prim_format.md">prim_format.md</a> and <a
href="doc/preview_surface.md">preview_surface.md</a></p>
<h2 id="example">Example</h2>
<h3 id="minimum-example-to-load-usdausdcusdz-file.">Minimum example to
load USDA/USDC/USDZ file.</h3>
<pre><code>// TinyUSDZ is not a header-only library, so no TINYUSDZ_IMPLEMENTATIONS
#include &quot;tinyusdz.hh&quot;

// Include pprinter.hh and value-pprint.hh if you want to print TinyUSDZ classes/structs/enums.
// `tinyusdz::to_string()` and `std::operator&lt;&lt;` for TinyUSDZ classes/enums are provided separately for faster compilation
#include &lt;iostream&gt;
#include &quot;pprinter.hh&quot;
#include &quot;value-pprint.hh&quot;

int main(int argc, char **argv) {

  std::string filename = &quot;input.usd&quot;;

  if (argc &gt; 1) {
    filename = argv[1];
  }

  tinyusdz::Stage stage; // Stage in USD terminology is nearly meant for Scene in generic 3D graphics terminology.
  std::string warn;
  std::string err;

  // Auto detect USDA/USDC/USDZ
  bool ret = tinyusdz::LoadUSDFromFile(filename, &amp;stage, &amp;warn, &amp;err);

  if (warn.size()) {
    std::cout &lt;&lt; &quot;WARN : &quot; &lt;&lt; warn &lt;&lt; &quot;\n&quot;;
  }

  if (!ret) {
    if (!err.empty()) {
      std::cerr &lt;&lt; &quot;ERR : &quot; &lt;&lt; warn &lt;&lt; &quot;\n&quot;;
    }
    return EXIT_FAILURE;
  }

  // Print Stage(Scene graph)
  std::cout &lt;&lt; tinyusdz::to_string(stage) &lt;&lt; &quot;\n&quot;;
  
  // You can also use ExportToString() as done in pxrUSD 
  // std::cout &lt;&lt; stage.ExportToString() &lt;&lt; &quot;\n&quot;;

  // stage.metas() To get Scene metadatum, 
  for (const Prim &amp;root_prim : stage.root_prims()) {
    std::cout &lt;&lt; root_prim.absolute_path() &lt;&lt; &quot;\n&quot;;
    // You can traverse Prim(scene graph object) using Prim::children()
    // See examples/api_tutorial and examples/tydra_api for details.
  }

  return EXIT_SUCCESS;
}</code></pre>
<h3 id="with-core-tinyusdz-api">With Core TinyUSDZ API</h3>
<p>Please see <a href="examples/api_tutorial/">api_tutorial</a></p>
<h3 id="with-tydra-api">With Tydra API</h3>
<p>Please see <a href="examples/tydra_api/">tydra_api</a></p>
<h2 id="todo">TODO</h2>
<h3 id="higher-priority">Higher priority</h3>
<ul class="task-list">
<li><label><input type="checkbox" />Built-in usdObj(wavefront .obj mesh)
support.</label>
<ul>
<li>via tinyobjloader.</li>
</ul></li>
<li><label><input type="checkbox" checked="" />Support Crate(binary)
version 0.8.0(USD v20.11 default)</label></li>
<li><label><input type="checkbox" />usdSkel utilities</label>
<ul class="task-list">
<li><label><input type="checkbox" />Joint hierachy reconstruction and
compute skinning matrix(usdSkel)</label></li>
<li><label><input type="checkbox" />Blend shapes</label>
<ul class="task-list">
<li><label><input type="checkbox" checked="" />Basic Blendshapes
support</label></li>
<li><label><input type="checkbox" />In-between blend shapes</label></li>
</ul></li>
</ul></li>
<li><label><input type="checkbox" />Read USD data with bounded memory
size. This feature is especially useful for mobile platform(e.g. in
terms of security, memory consumption, etc)</label></li>
<li><label><input type="checkbox" />USDC writer</label></li>
<li><label><input type="checkbox" />Support Nested USDZ</label></li>
<li><label><input type="checkbox" />UDIM texture support</label></li>
<li><label><input type="checkbox" />MaterialX support</label>
<ul class="task-list">
<li><label><input type="checkbox" />Parse XML file using
tinyxml2</label></li>
</ul></li>
</ul>
<h3 id="middle-priority">Middle priority</h3>
<ul class="task-list">
<li><label><input type="checkbox" />Composition arcs</label></li>
<li><label><input type="checkbox" />Code refactoring, code
optimization</label></li>
</ul>
<h3 id="lower-priority">Lower priority</h3>
<ul class="task-list">
<li><label><input type="checkbox" />iOS example?</label></li>
<li><label><input type="checkbox" />Support AR related schema(Game-like
feature added by Reality Composer?)</label></li>
<li><label><input type="checkbox" />Audio play support</label>
<ul class="task-list">
<li><label><input type="checkbox" />Play audio using SoLoud or
miniaudio(or Oboe for Android)</label></li>
<li><label><input type="checkbox" />wav(dr_wav)</label></li>
<li><label><input type="checkbox" />mp3(dr_mp3)</label></li>
<li><label><input type="checkbox" />m4a(ALAC?)</label></li>
</ul></li>
<li><label><input type="checkbox" />Viewer with Vulkan API.</label></li>
<li><label><input type="checkbox" />Replace OpenSubdiv with our own
subdiv library.</label></li>
<li><label><input type="checkbox" />Write parser based on the schema
definition.</label></li>
<li><label><input type="checkbox" />Support big endian
architecture.</label></li>
</ul>
<h2 id="python-binding-and-prebuit-packages">Python binding and prebuit
packages</h2>
<p>Python binding and prebuilt packages(uploadded on PyPI) are
provided.</p>
<p>See <a href="python/README.md">python/README.md</a> and <a
href="doc/python_binding.md">doc/python_binding.md</a> for details.</p>
<h2 id="ci-build">CI build</h2>
<p>CI build script is a build script trying to build TinyUSDZ in
self-contained manner as much as possible(including custom Python
build)</p>
<h3 id="linuxmacos">Linux/macOS</h3>
<p>T.B.W.</p>
<h3 id="windows">Windows</h3>
<p>Build custom Python,</p>
<pre><code>&gt; ci-build-python-lib.bat</code></pre>
<p>then build TinyUSDZ by linking with this local Python build.</p>
<pre><code>&gt; ci-build-vs2022.bat</code></pre>
<h4
id="cross-compile-with-clang-cl-msvc-sdk-on-linux-and-run-it-on-wineno-windows-required-at-all-solution">Cross
compile with clang-cl + MSVC SDK on linux and run it on WINE(No Windows
required at all solution!)</h4>
<p>clang-cl(MSVC cl.exe) + MSVC SDK cross compile is also supported.</p>
<p>Please take a look at <a href="doc/wine_cl.md">doc/wine_cl.md</a></p>
<p>You can build pure Windows build of TinyUSDZ on Linux CI machine.</p>
<h2 id="license">License</h2>
<p>TinyUSDZ is primarily licensed under Apache 2.0 license. Some helper
code is licensed under MIT license.</p>
<h3 id="third-party-licenses">Third party licenses</h3>
<ul>
<li>pxrUSD : Apache 2.0 license.
https://github.com/PixarAnimationStudios/USD</li>
<li>OpenSubdiv : Apache 2.0 license.
https://github.com/PixarAnimationStudios/OpenSubdiv</li>
<li>lz4 : BSD-2 license. http://www.lz4.org</li>
<li>cnpy(uncompressed ZIP decode/encode code) : MIT license
https://github.com/rogersce/cnpy</li>
<li>tinyexr: BSD license.</li>
<li>tinyobjloader: MIT license.</li>
<li>tinygltf: MIT license.</li>
<li>tinycolorio: MIT license. https://github.com/syoyo/tinycolorio</li>
<li>stb_image, stb_image_resize, stb_image_write, stb_truetype: public
domain.</li>
<li>dr_libs: public domain. https://github.com/mackron/dr_libs</li>
<li>miniaudio: public domain or MIT no attribution.
https://github.com/dr-soft/miniaudio</li>
<li>SDL2 : zlib license. https://www.libsdl.org/index.php</li>
<li>optional-lite: BSL 1.0 license.
https://github.com/martinmoene/optional-lite</li>
<li>expected-lite: BSL 1.0 license.
https://github.com/martinmoene/expected-lite</li>
<li>mapbox/earcut.hpp: ISC license.
https://github.com/mapbox/earcut.hpp</li>
<li>par_shapes.h generate parametric surfaces and other simple shapes:
MIT license https://github.com/prideout/par</li>
<li>MaterialX: Apache 2.0 license.
https://github.com/AcademySoftwareFoundation/MaterialX</li>
<li>string_id: zlib license. https://github.com/foonathan/string_id</li>
<li>cityhash: MIT license. https://github.com/google/cityhash</li>
<li>fast_float: Apache 2.0/MIT dual license.
https://github.com/fastfloat/fast_float</li>
<li>jsteeman/atoi: Apache 2.0 license.
https://github.com/jsteemann/atoi</li>
<li>formatxx: unlicense.
https://github.com/seanmiddleditch/formatxx</li>
<li>ubench.h: Unlicense. https://github.com/sheredom/ubench.h</li>
<li>thelink2012/any : BSL-1.0 license.
https://github.com/thelink2012/any</li>
<li>simple_match : BSL-1.0 license.
https://github.com/jbandela/simple_match</li>
<li>nanobind : BSD-3 license. https://github.com/wjakob/nanobind</li>
<li>pybind11 : BSD-3 license. https://github.com/pybind/pybind11</li>
<li>pystring : BSD-3 license.
https://github.com/imageworks/pystring</li>
<li>gulrak/filesytem : MIT license.
https://github.com/gulrak/filesystem</li>
<li>p-ranav/glob : MIT license. https://github.com/p-ranav/glob</li>
<li>linalg.h : Unlicense. https://github.com/sgorsten/linalg</li>
<li>mapbox/eternal: ISC License. https://github.com/mapbox/eternal</li>
<li>bvh: MIT license. https://github.com/madmann91/bvh</li>
<li>dtoa_milo.h: MIT License.
https://github.com/miloyip/dtoa-benchmark</li>
<li>jeaiii/itoa: MIT License. https://github.com/jeaiii/itoa</li>
<li>alac: Apache 2.0 License. https://macosforge.github.io/alac/</li>
<li>OpenFBX: MIT License. https://github.com/nem0/OpenFBX</li>
<li>floaxie: Apache 2.0 License. https://github.com/aclex/floaxie</li>
<li>boost math sin_pi/cos_pi: BSL 1.0 License.
https://www.boost.org/</li>
<li>Vulkan: MIT License. https://github.com/SaschaWillems/Vulkan</li>
<li>Metal.cpp: Apache 2.0 License.
https://github.com/bkaradzic/metal-cpp
https://developer.apple.com/metal/cpp/</li>
<li>sRGB transform: MIT license.
https://www.nayuki.io/page/srgb-transform-library</li>
<li>virtualGizmo3D: BSD-2 license.
https://github.com/BrutPitt/virtualGizmo3D</li>
<li>nanozlib: Apache 2.0 license.
https://github.com/lighttransport/nanozlib</li>
<li>lz4.py: MIT license.
https://github.com/SE2Dev/PyCoD/blob/master/_lz4.py</li>
<li>pugixml: MIT license. https://github.com/zeux/pugixml</li>
<li>nanoflann: 2-clause BSD license.
https://github.com/jlblancoc/nanoflann</li>
<li>tinymeshutils: MIT license.
https://github.com/syoyo/tinymeshutils</li>
</ul>
