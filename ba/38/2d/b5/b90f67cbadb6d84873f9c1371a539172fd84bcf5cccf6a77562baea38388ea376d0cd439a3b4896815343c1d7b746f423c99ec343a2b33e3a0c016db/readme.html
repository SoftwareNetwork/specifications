<h1 id="libopnmidi">libOPNMIDI</h1>
<p>libOPNMIDI is a free Software MIDI synthesizer library with OPN2 (YM2612) emulation</p>
<p>OPNMIDI Library: Copyright (c) 2017-2019 Vitaly Novichkov <a href="mailto:admin@wohlnet.ru">admin@wohlnet.ru</a></p>
<p>Library is based on core of the <a href="https://github.com/Wohlstand/libADLMIDI">libADLMIDI</a>, a MIDI playing library with OPL3 emulation.</p>
<ul>
<li>Semaphore-CI: <a href="https://semaphoreci.com/wohlstand/libopnmidi"><img src="https://semaphoreci.com/api/v1/wohlstand/libopnmidi/branches/master/badge.svg" alt="Build Status" /></a></li>
<li>AppVeyor CI: <a href="https://ci.appveyor.com/project/Wohlstand/libopnmidi"><img src="https://ci.appveyor.com/api/projects/status/98m4ltr1swyg7s5y?svg=true" alt="Build status" /></a></li>
<li>Travis CI: <a href="https://travis-ci.org/Wohlstand/libOPNMIDI"><img src="https://travis-ci.org/Wohlstand/libOPNMIDI.svg?branch=master" alt="Build Status" /></a></li>
</ul>
<h1 id="tested-on-platforms">Tested on platforms</h1>
<ul>
<li>Linux GCC 4.8, 4.9, 5.4 / CLang</li>
<li>Mac OS X CLang (Xcode 7.x)</li>
<li>Windows MinGW 4.9.x, 5.2</li>
<li>Android NDK 12b/13</li>
<li>OpenBSD</li>
<li>Haiku</li>
<li>Emscripten</li>
</ul>
<h1 id="key-features">Key features</h1>
<ul>
<li>OPN2 emulation</li>
<li>Customizable bank of FM patches (You have to use the <a href="https://github.com/Wohlstand/OPN2BankEditor">bank editor</a> to create own soundbank)</li>
<li>Stereo sound</li>
<li>Number of simulated OPN2 chips can be specified as 1-100 (maximum channels 600!)</li>
<li>Pan (binary panning, i.e. left/right side on/off)</li>
<li>Pitch-bender with adjustable range</li>
<li>Vibrato that responds to RPN/NRPN parameters</li>
<li>Sustain (a.k.a. Pedal hold) and Sostenuto enable/disable</li>
<li>MIDI and RMI file support</li>
<li>Real-Time MIDI API support</li>
<li>MIDI and RMI file support</li>
<li>loopStart / loopEnd tag support (Final Fantasy VII)</li>
<li>111'th controller based loop start (RPG-Maker)</li>
<li>Use automatic arpeggio with chords to relieve channel pressure</li>
<li>Support for multiple concurrent MIDI synthesizers (per-track device/port select FF 09 message), can be used to overcome 16 channel limit</li>
<li>Partial support for GS and XG standards (having more instruments than in one 128:128 GM set and ability to use multiple channels for percussion purposes, and support for some GS/XG exclusive controllers)</li>
<li>CC74 &quot;Brightness&quot; affects a modulator scale (to simulate frequency cut-off on WT synths)</li>
<li>Portamento support (CC5, CC37, and CC65)</li>
<li>SysEx support that supports some generic, GS, and XG features</li>
<li>Full-panning stereo option (works for emulators only)</li>
</ul>
<h1 id="how-to-build">How to build</h1>
<p>To build libOPNMIDI you need to use CMake:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="fu">mkdir</span> build
<span class="bu">cd</span> build
<span class="fu">cmake</span> -DCMAKE_BUILD_TYPE=Release ..
<span class="fu">make</span>
<span class="fu">sudo</span> make install</code></pre></div>
<h1 id="license">License</h1>
<p>The library is licensed under in it's parts LGPL 2.1+, GPL v2+, GPL v3+, and MIT. * Nuked OPN2 emulator is licensed under LGPL v2.1+. * GENS 2.10 emulator is licensed under LGPL v2.1+. * MAME YM2612 emulator is licensed under GPL v2+. * Genesis Plus GX emulator is licensed under GPL v2+. * Chip interfaces are licensed under LGPL v2.1+. * File Reader class and MIDI Sequencer is licensed under MIT. * Other parts of library are licensed under GPLv3+.</p>
<h2 id="available-cmake-options">Available CMake options</h2>
<ul>
<li><strong>CMAKE_PREFIX_PATH</strong> - destination folder where libOPNMIDI will be installed. On Linux it is /usr/local/ by default.</li>
<li><strong>CMAKE_BUILD_TYPE</strong> - Build types: <strong>Debug</strong> or <strong>Release</strong></li>
<li><strong>WITH_MIDIPLAY</strong> - (ON/OFF, default OFF) Build demo MIDI player (Requires SDL2 and also pthread on Windows with MinGW)</li>
<li><strong>WITH_VLC_PLUGIN</strong> - (ON/OFF, default OFF) Compile VLC plugin. For now, works on Linux and VLC version 2.2.2. Support for newer VLC versions and other platforms comming soon!</li>
<li><strong>WITH_MIDI_SEQUENCER</strong> - (ON/OFF, default ON) Enable built-in MIDI sequencer to play loaded MIDI files. When you will disable MIDI sequencer, Real-Time functions only will work. Use this option when you are making MIDI plugin or real-time MIDI driver.</li>
<li><strong>USE_MAME_EMULATOR</strong> - (ON/OFF, default ON) Enable support for MAME YM2612 emulator. Well-accurate and fast on slow devices.</li>
<li><strong>USE_NUKED_EMULATOR</strong> - (ON/OFF, default ON) Enable support for Nuked OPN2 emulator. Very accurate, however, requires a very powerful CPU. <em>Is not recommended for mobile devices!</em>.</li>
<li><strong>USE_GENS_EMULATOR</strong> - (ON/OFF, default ON) Enable support for GENS 2.10 emulator. Very outdated and inaccurate, but fastest.</li>
<li><strong>WITH_MUS_SUPPORT</strong> - (ON/OFF, default ON) Enable support for DMX MUS format in built-in MIDI sequencer.</li>
<li><strong>WITH_XMI_SUPPORT</strong> - (ON/OFF, default ON) Enable support for AIL XMI format in built-in MIDI sequencer.</li>
<li><p><strong>WITH_UNIT_TESTS</strong> - (ON/OFF, default OFF) Also compile unit-tests of internal features.</p></li>
<li><strong>libOPNMIDI_STATIC</strong> - (ON/OFF, default ON) Build static library</li>
<li><p><strong>libOPNMIDI_SHARED</strong> - (ON/OFF, default OFF) Build shared library</p></li>
</ul>
<h2 id="you-also-can-build-library-manually">You also can build library manually:</h2>
<p>You need to make in the any IDE a library project and put into it next files (or include those files into subfolder of your exist project instead if you want to use it statically):</p>
<h3 id="useful-macros">Useful macros</h3>
<ul>
<li><code>BWMIDI_DISABLE_XMI_SUPPORT</code> - Disables XMI to MIDI converter</li>
<li><code>BWMIDI_DISABLE_MUS_SUPPORT</code> - Disables MUS to MIDI converter</li>
<li><code>OPNMIDI_DISABLE_MIDI_SEQUENCER</code> - Completely disables built-in MIDI sequencer.</li>
<li><code>OPNMIDI_USE_LEGACY_EMULATOR</code> - Enables Gens 2.10 YM2612 emulator to be used. Nuked OPN2 is used by default if macro is not defined.</li>
</ul>
<h3 id="public-header-include">Public header (include)</h3>
<ul>
<li>opnmidi.h - Library API, use it to control library</li>
</ul>
<h3 id="internal-code-src">Internal code (src)</h3>
<ul>
<li>opnbank.h - bank structures definition</li>
<li><p>opnmidi_private.hpp - header of internal private APIs</p></li>
<li><p>opnmidi.cpp - code of library</p></li>
<li>opnmidi_load.cpp - Source of file loading and parsing processing</li>
<li>opnmidi_midiplay.cpp - MIDI event sequencer</li>
<li>opnmidi_opn2.cpp - OPN2 chips manager</li>
<li><p>opnmidi_private.cpp - some internal functions sources</p></li>
<li>opnmidi_bankmap.h - MIDI bank hash table</li>
<li>opnmidi_bankmap.tcc - MIDI bank hash table (Implementation)</li>
<li>opnmidi_cvt.hpp - Instrument conversion template</li>
<li>opnmidi_ptr.hpp - Custom implementations of smart pointers for C++98</li>
<li><p>file_reader.hpp - Generic file and memory reader</p></li>
<li><code>chips/opn_chip_base.h</code> - Header of base class over all emulation cores</li>
<li><p><code>chips/opn_chip_base.tcc</code> - Code of base class over all emulation cores</p></li>
<li>chips/gens_opn2.h - Header of emulator frontent over Gens 2.10 emulator</li>
<li>chips/gens_opn2.cpp - Code of emulator frontent over Gens 2.10 emulator</li>
<li>chips/gens/Ym2612_ChipEmu.h - Gens 2.10 OPN2 Emulation header</li>
<li><p>chips/gens/Ym2612_ChipEmu.cpp - Code of Gens 2.10 OPN2 emulator by Stéphane Dallongeville, improved by Shay Green</p></li>
<li>chips/mame_opn2.h - Header of emulator frontent over MAME YM2612 emulator</li>
<li>chips/mame_opn2.cpp - Code of emulator frontent over MAME YM2612 emulator</li>
<li>chips/mame/mame_ym2612fm.h - MAME YM2612 Emulation header</li>
<li><p>chips/mame/mame_ym2612fm.cpp - Code of MAME YM2612 emulator by Stéphane Dallongeville, improved by Shay Green</p></li>
<li>chips/nuked_opn2.h - Header of emulator frontent over Nuked OPN2 emulator</li>
<li>chips/nuked_opn2.cpp - Code of emulator frontent over Nuked OPN2 emulator</li>
<li>chips/nuked/ym3438.h - Nuked OPN2 Emulation header</li>
<li><p>chips/nuked/ym3438.cpp - Code of Nuked OPN2 emulator by Stéphane Dallongeville, improved by Shay Green</p></li>
<li><p>wopn/* - WOPN bank format library</p></li>
</ul>
<h4 id="midi-sequencer">MIDI Sequencer</h4>
<p>To remove MIDI Sequencer, define <code>OPNMIDI_DISABLE_MIDI_SEQUENCER</code> macro and remove all those files * adlmidi_sequencer.cpp - MIDI Sequencer related source * cvt_mus2mid.hpp - MUS2MID converter source (define <code>BWMIDI_DISABLE_MUS_SUPPORT</code> macro to remove MUS support) * cvt_xmi2mid.hpp - XMI2MID converter source (define <code>BWMIDI_DISABLE_XMI_SUPPORT</code> macro to remove XMI support) * fraction.hpp - Fraction number handling (Used by Sequencer only) * midi_sequencer.h - MIDI Sequencer C bindings * midi_sequencer.hpp - MIDI Sequencer C++ declaration * midi_sequencer_impl.hpp - MIDI Sequencer C++ implementation (must be once included into one of CPP together with interfaces initializations)</p>
<p><strong>Important</strong>: Please use GENS emulator for on mobile or any non-power devices because it requires very small CPU power. Nuked OPN2 emulator is very accurate (compared to real OPN2 chip), however, it requires a VERY POWERFUL device even for a single chip emulation and is a high probability that your device will lag and playback will be dirty and choppy.</p>
<h1 id="working-demos">Working demos</h1>
<ul>
<li><a href="http://wohlsoft.ru/docs/_laboratory/_Builds/win32/bin-w32/_packed/pge-musplay-dev-win32.zip">PGE MusPlay for Win32</a> and <a href="http://wohlsoft.ru/docs/_laboratory/_Builds/win32/bin-w64/_packed/pge-musplay-dev-win64.zip">Win64</a> (also available for other platforms as part of <a href="https://github.com/WohlSoft/PGE-Project">PGE Project</a>) - a little music player which uses SDL Mixer X library (fork of the SDL Mixer 2.0) which has embedded libOPNMIDI to play MIDI files independently from operating system's settings and drivers. <br>(source code of player can be find <a href="https://github.com/WohlSoft/PGE-Project/tree/master/MusicPlayer">here</a> and source code of SDL Mixer X <a href="https://github.com/WohlSoft/SDL-Mixer-X/">here</a>)</li>
<li><a href="https://github.com/Wohlstand/OPNMIDI-Player-Java/">OPNMIDI Player for Android</a> - a little MIDI-player for Android which uses libOPNMIDI to play MIDI files and provides flexible GUI with ability to change bank, flags, number of emulated chips, etc.</li>
</ul>
<h1 id="changelog">Changelog</h1>
<h2 id="section">1.4.1 <dev></h2>
<ul>
<li>Added support for OPNA chip with Neko Project II Kai YM2602 emulator usage (Thanks to <a href="https://github.com/jpcima">Jean Pierre Cimalando</a> for a work!)</li>
<li>Added VGM file dumper which allows to output OPN2 commands into VGM file. (A new MIDI to VGM tool is now created with basing on libOPNMIDI)</li>
</ul>
<h2 id="section-1">1.4.0 2018-10-01</h2>
<ul>
<li>Implemented a full support for Portamento! (Thanks to <a href="https://github.com/jpcima">Jean Pierre Cimalando</a> for a work!)</li>
<li>Added support for SysEx event handling! (Thanks to <a href="https://github.com/jpcima">Jean Pierre Cimalando</a> for a work!)</li>
<li>Added support for GS way of custom drum channels (through SysEx events)</li>
<li>Ignore some NRPN events and lsb bank number when using GS standard (after catching of GS Reset SysEx call)</li>
<li>Added support for CC66-Sostenuto controller (Pedal hold of currently-pressed notes only while CC64 holds also all next notes)</li>
<li>Added support for CC67-SoftPedal controller (SoftPedal lowers the volume of notes played)</li>
<li>Resolved a trouble which sometimes makes a junk noise sound and unnecessary overuse of chip channels</li>
<li>Volume models support taken from libADLMIDI has been adapted to OPN2's chip speficis</li>
<li>Fixed inability to play high notes due physical tone frequency out of range on the OPN2 chip</li>
<li>Added support for full-panning stereo option</li>
</ul>
<h2 id="section-2">1.3.0 2018-06-19</h2>
<ul>
<li>Optimizing the MIDI banks management system for MultiBanks (Thanks to <a href="https://github.com/jpcima">Jean Pierre Cimalando</a> for a work!)</li>
<li>Fixed incorrect initial MIDI tempo when MIDI file doesn't includes the tempo event</li>
<li>Fixed an incorrect processing of auto-flags</li>
<li>MAME YM2612 now results a more accurate sound as internal using of native sample rate makes more correct sound generation</li>
<li>Channel and Note Aftertouch features are now supported correctly! Aftertouch is the tremolo / vibrato, NOT A VOLUME!</li>
<li>Added optional HQ resampler for Nuked OPL3 emulators which does usage of Zita-Resampler library (Thanks to <a href="https://github.com/jpcima">Jean Pierre Cimalando</a> for a work!)</li>
</ul>
<h2 id="section-3">1.2.0 2018-04-24</h2>
<ul>
<li>Added ability to disable MUS and XMI converters</li>
<li>Added ability to disable embedded MIDI sequencer to use library as RealTime synthesizer only or use any custom MIDI sequencer plugins.</li>
<li>Fixed blank instruments fallback in multi-bank support. When using non-zero bank, if instrument is blank, then, instrument will be taken from a root (I.e. zero bank).</li>
<li>Added support for real-time switching the emulator</li>
<li>Added support for MAME YM2612 Emulator</li>
<li>Added support for CC-120 - &quot;All sound off&quot; on the MIDI channel</li>
<li>Changed logic of CC-74 Brightness to affect sound only between 0 and 64 like real XG synthesizers. Ability to turn on a full-ranged brightness (to use full 0...127 range) is kept.</li>
<li>Added support for different output sample formats (PCM8, PCM8U, PCM16, PCM16U, PCM32, PCM32U, Float32, and Float64) (Thanks to <a href="https://github.com/jpcima">Jean Pierre Cimalando</a> for a work!)</li>
<li>Reworked MIDI channels management to avoid any memory reallocations while music processing for a hard real time. (Thanks to <a href="https://github.com/jpcima">Jean Pierre Cimalando</a> for a work!)</li>
</ul>
<h2 id="section-4">1.1.0 2018-01-21</h2>
<ul>
<li>First stable release</li>
<li>Contains all features are made in libADLMIDI 1.3.1</li>
</ul>
<h2 id="beta-2017-05-06">1.0.0-beta 2017-05-06</h2>
<ul>
<li>First experimental release</li>
</ul>
