<h1 id="s3tc-dxt1dxt5-texture-decompression">S3TC DXT1/DXT5 Texture
Decompression</h1>
<p>This is the reposting of some S3TC DXT texture decompression routines
that I wrote and published to an old blog in 2009.</p>
<h2 id="why-republish">Why republish?</h2>
<p>I hadn’t thought about these routines in a very long time, but I
recently discovered my name in some Amazon Fire copyright notices and
traced the notice back to these routines, or a derivative thereof, being
include in <a
href="https://github.com/FFmpeg/FFmpeg/blob/master/libavcodec/texturedsp.c">ffmpeg</a>,
which I thought was pretty nifty. Completely coincidentally, the very
next day I received an email asking about these very same routines. I
figured that was a sign that I should share these routines again via a
more modern mechanism.</p>
<h2 id="dual-license">(Dual) License</h2>
<p>When using these routines, feel free to chose one of either:</p>
<ul>
<li>My original worded “license” (which was intended to be essentially
public domain).</li>
<li>The MIT license</li>
</ul>
<p>My original worded “license” was intended to be extremely permissive
and does not require attribution. However, given it is highly
non-standard (not checked over by a lawyer) then that may lead to
ambiguity. If you need something a bit more solid then the MIT license
ought to meet your needs.</p>
<h2 id="original-blog-post">Original Blog Post</h2>
<p><em>October 21st, 2009</em></p>
<blockquote>
<p>Earlier this year I offered to write the <a
href="http://en.wikipedia.org/wiki/S3_Texture_Compression">S3TC</a>
decompression routines that allowed texture exporting functionality to
be included in the ‘Collada Exporter’ plug-in for the <a
href="http://www.terathon.com/c4engine/index.php">C4 Engine</a>. After
doing a bit of research I was pointed towards the <a
href="http://www.opengl.org/registry/specs/EXT/texture_compression_s3tc.txt">perfect
resource</a> by C4’s creator, Eric Lengyel. Any information I’d found
prior to this made the process sound a bit convoluted but after looking
over the reference I was able to write the decompression routines with
relative ease.</p>
<p>I basically forgot about these routines until a couple of days ago
when the question of how to decompress S3TC (specifically DXT1 and DXT5)
textures was brought up on the <a href="http://creators.xna.com/">XNA
Creators Club</a> forums. As a result I’ve decided to release the
methods that I wrote. In order to ensure the code compiled fine in any
project I’ve removed all the C4 specific data-types and methods, and
I’ve made no use of any methods that aren’t included. As a result things
became a little messier, hopefully the code is still understandable.
Without further ado here are my C++ methods to decompress DXT1 and DXT5
textures:</p>
<p>I’m still in the midst of writing an entry on iPhone, ASP .NET, Linux
and Mono so if you’re at all interested check back here in a few
days.</p>
</blockquote>
<p><strong>Note:</strong> <em>Although the C++ routines are reproduced
below (as in the original blog post), they’re also available in
<code>s3tc.cpp</code>.</em></p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// --------------------------------------------------------------------------------</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">// S3TC DXT1 / DXT5 Texture Decompression Routines</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Author: Benjamin Dobell - http://www.glassechidna.com.au</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Feel free to use these methods in any open-source, freeware or commercial</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">// projects. It&#39;s not necessary to credit me however I would be grateful if you</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">// chose to do so. I&#39;ll also be very interested to hear what projects make use of</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">// this code. Feel free to drop me a line via the contact form on the Glass Echidna</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">// website.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">// </span><span class="al">NOTE</span><span class="co">: The code was written for a little endian system where sizeof(long) == 4.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">// --------------------------------------------------------------------------------</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">// unsigned long PackRGBA(): Helper method that packs RGBA channels into a single 4 byte pixel.</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co">// unsigned char r:     red channel.</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">// unsigned char g:     green channel.</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">// unsigned char b:     blue channel.</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co">// unsigned char a:     alpha channel.</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">long</span> PackRGBA<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span> r<span class="op">,</span> <span class="dt">unsigned</span> <span class="dt">char</span> g<span class="op">,</span> <span class="dt">unsigned</span> <span class="dt">char</span> b<span class="op">,</span> <span class="dt">unsigned</span> <span class="dt">char</span> a<span class="op">)</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">((</span>r <span class="op">&lt;&lt;</span> <span class="dv">24</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span>g <span class="op">&lt;&lt;</span> <span class="dv">16</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span>b <span class="op">&lt;&lt;</span> <span class="dv">8</span><span class="op">)</span> <span class="op">|</span> a<span class="op">);</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co">// void DecompressBlockDXT1(): Decompresses one block of a DXT1 texture and stores the resulting pixels at the appropriate offset in &#39;image&#39;.</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co">// unsigned long x:                     x-coordinate of the first pixel in the block.</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co">// unsigned long y:                     y-coordinate of the first pixel in the block.</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co">// unsigned long width:                 width of the texture being decompressed.</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co">// unsigned long height:                height of the texture being decompressed.</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co">// const unsigned char *blockStorage:   pointer to the block to decompress.</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co">// unsigned long *image:                pointer to image where the decompressed pixel data should be stored.</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> DecompressBlockDXT1<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">long</span> x<span class="op">,</span> <span class="dt">unsigned</span> <span class="dt">long</span> y<span class="op">,</span> <span class="dt">unsigned</span> <span class="dt">long</span> width<span class="op">,</span> <span class="at">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>blockStorage<span class="op">,</span> <span class="dt">unsigned</span> <span class="dt">long</span> <span class="op">*</span>image<span class="op">)</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">short</span> color0 <span class="op">=</span> <span class="op">*</span><span class="kw">reinterpret_cast</span><span class="op">&lt;</span><span class="at">const</span> <span class="dt">unsigned</span> <span class="dt">short</span> <span class="op">*&gt;(</span>blockStorage<span class="op">);</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">short</span> color1 <span class="op">=</span> <span class="op">*</span><span class="kw">reinterpret_cast</span><span class="op">&lt;</span><span class="at">const</span> <span class="dt">unsigned</span> <span class="dt">short</span> <span class="op">*&gt;(</span>blockStorage <span class="op">+</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> temp<span class="op">;</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> <span class="op">(</span>color0 <span class="op">&gt;&gt;</span> <span class="dv">11</span><span class="op">)</span> <span class="op">*</span> <span class="dv">255</span> <span class="op">+</span> <span class="dv">16</span><span class="op">;</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> r0 <span class="op">=</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">)((</span>temp<span class="op">/</span><span class="dv">32</span> <span class="op">+</span> temp<span class="op">)/</span><span class="dv">32</span><span class="op">);</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> <span class="op">((</span>color0 <span class="op">&amp;</span> <span class="bn">0x07E0</span><span class="op">)</span> <span class="op">&gt;&gt;</span> <span class="dv">5</span><span class="op">)</span> <span class="op">*</span> <span class="dv">255</span> <span class="op">+</span> <span class="dv">32</span><span class="op">;</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> g0 <span class="op">=</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">)((</span>temp<span class="op">/</span><span class="dv">64</span> <span class="op">+</span> temp<span class="op">)/</span><span class="dv">64</span><span class="op">);</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> <span class="op">(</span>color0 <span class="op">&amp;</span> <span class="bn">0x001F</span><span class="op">)</span> <span class="op">*</span> <span class="dv">255</span> <span class="op">+</span> <span class="dv">16</span><span class="op">;</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> b0 <span class="op">=</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">)((</span>temp<span class="op">/</span><span class="dv">32</span> <span class="op">+</span> temp<span class="op">)/</span><span class="dv">32</span><span class="op">);</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> <span class="op">(</span>color1 <span class="op">&gt;&gt;</span> <span class="dv">11</span><span class="op">)</span> <span class="op">*</span> <span class="dv">255</span> <span class="op">+</span> <span class="dv">16</span><span class="op">;</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> r1 <span class="op">=</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">)((</span>temp<span class="op">/</span><span class="dv">32</span> <span class="op">+</span> temp<span class="op">)/</span><span class="dv">32</span><span class="op">);</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> <span class="op">((</span>color1 <span class="op">&amp;</span> <span class="bn">0x07E0</span><span class="op">)</span> <span class="op">&gt;&gt;</span> <span class="dv">5</span><span class="op">)</span> <span class="op">*</span> <span class="dv">255</span> <span class="op">+</span> <span class="dv">32</span><span class="op">;</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> g1 <span class="op">=</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">)((</span>temp<span class="op">/</span><span class="dv">64</span> <span class="op">+</span> temp<span class="op">)/</span><span class="dv">64</span><span class="op">);</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> <span class="op">(</span>color1 <span class="op">&amp;</span> <span class="bn">0x001F</span><span class="op">)</span> <span class="op">*</span> <span class="dv">255</span> <span class="op">+</span> <span class="dv">16</span><span class="op">;</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> b1 <span class="op">=</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">)((</span>temp<span class="op">/</span><span class="dv">32</span> <span class="op">+</span> temp<span class="op">)/</span><span class="dv">32</span><span class="op">);</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> code <span class="op">=</span> <span class="op">*</span><span class="kw">reinterpret_cast</span><span class="op">&lt;</span><span class="at">const</span> <span class="dt">unsigned</span> <span class="dt">long</span> <span class="op">*&gt;</span>t<span class="op">(</span>blockStorage <span class="op">+</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j<span class="op">=</span><span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> <span class="dv">4</span><span class="op">;</span> j<span class="op">++)</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">4</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>            <span class="dt">unsigned</span> <span class="dt">long</span> finalColor <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>            <span class="dt">unsigned</span> <span class="dt">char</span> positionCode <span class="op">=</span> <span class="op">(</span>code <span class="op">&gt;&gt;</span>  <span class="dv">2</span><span class="op">*(</span><span class="dv">4</span><span class="op">*</span>j<span class="op">+</span>i<span class="op">))</span> <span class="op">&amp;</span> <span class="bn">0x03</span><span class="op">;</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>color0 <span class="op">&gt;</span> color1<span class="op">)</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>                <span class="cf">switch</span> <span class="op">(</span>positionCode<span class="op">)</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">case</span> <span class="dv">0</span><span class="op">:</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>                        finalColor <span class="op">=</span> PackRGBA<span class="op">(</span>r0<span class="op">,</span> g0<span class="op">,</span> b0<span class="op">,</span> <span class="dv">255</span><span class="op">);</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">case</span> <span class="dv">1</span><span class="op">:</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>                        finalColor <span class="op">=</span> PackRGBA<span class="op">(</span>r1<span class="op">,</span> g1<span class="op">,</span> b1<span class="op">,</span> <span class="dv">255</span><span class="op">);</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">case</span> <span class="dv">2</span><span class="op">:</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>                        finalColor <span class="op">=</span> PackRGBA<span class="op">((</span><span class="dv">2</span><span class="op">*</span>r0<span class="op">+</span>r1<span class="op">)/</span><span class="dv">3</span><span class="op">,</span> <span class="op">(</span><span class="dv">2</span><span class="op">*</span>g0<span class="op">+</span>g1<span class="op">)/</span><span class="dv">3</span><span class="op">,</span> <span class="op">(</span><span class="dv">2</span><span class="op">*</span>b0<span class="op">+</span>b1<span class="op">)/</span><span class="dv">3</span><span class="op">,</span> <span class="dv">255</span><span class="op">);</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">case</span> <span class="dv">3</span><span class="op">:</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>                        finalColor <span class="op">=</span> PackRGBA<span class="op">((</span>r0<span class="op">+</span><span class="dv">2</span><span class="op">*</span>r1<span class="op">)/</span><span class="dv">3</span><span class="op">,</span> <span class="op">(</span>g0<span class="op">+</span><span class="dv">2</span><span class="op">*</span>g1<span class="op">)/</span><span class="dv">3</span><span class="op">,</span> <span class="op">(</span>b0<span class="op">+</span><span class="dv">2</span><span class="op">*</span>b1<span class="op">)/</span><span class="dv">3</span><span class="op">,</span> <span class="dv">255</span><span class="op">);</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>                <span class="cf">switch</span> <span class="op">(</span>positionCode<span class="op">)</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">case</span> <span class="dv">0</span><span class="op">:</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>                        finalColor <span class="op">=</span> PackRGBA<span class="op">(</span>r0<span class="op">,</span> g0<span class="op">,</span> b0<span class="op">,</span> <span class="dv">255</span><span class="op">);</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">case</span> <span class="dv">1</span><span class="op">:</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>                        finalColor <span class="op">=</span> PackRGBA<span class="op">(</span>r1<span class="op">,</span> g1<span class="op">,</span> b1<span class="op">,</span> <span class="dv">255</span><span class="op">);</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">case</span> <span class="dv">2</span><span class="op">:</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>                        finalColor <span class="op">=</span> PackRGBA<span class="op">((</span>r0<span class="op">+</span>r1<span class="op">)/</span><span class="dv">2</span><span class="op">,</span> <span class="op">(</span>g0<span class="op">+</span>g1<span class="op">)/</span><span class="dv">2</span><span class="op">,</span> <span class="op">(</span>b0<span class="op">+</span>b1<span class="op">)/</span><span class="dv">2</span><span class="op">,</span> <span class="dv">255</span><span class="op">);</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">case</span> <span class="dv">3</span><span class="op">:</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>                        finalColor <span class="op">=</span> PackRGBA<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">255</span><span class="op">);</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>x <span class="op">+</span> i <span class="op">&lt;</span> width<span class="op">)</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>                image<span class="op">[(</span>y <span class="op">+</span> j<span class="op">)*</span>width <span class="op">+</span> <span class="op">(</span>x <span class="op">+</span> i<span class="op">)]</span> <span class="op">=</span> finalColor<span class="op">;</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a><span class="co">// void BlockDecompressImageDXT1(): Decompresses all the blocks of a DXT1 compressed texture and stores the resulting pixels in &#39;image&#39;.</span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a><span class="co">// unsigned long width:                 Texture width.</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a><span class="co">// unsigned long height:                Texture height.</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a><span class="co">// const unsigned char *blockStorage:   pointer to compressed DXT1 blocks.</span></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a><span class="co">// unsigned long *image:                pointer to the image where the decompressed pixels will be stored.</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> BlockDecompressImageDXT1<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">long</span> width<span class="op">,</span> <span class="dt">unsigned</span> <span class="dt">long</span> height<span class="op">,</span> <span class="at">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>blockStorage<span class="op">,</span> <span class="dt">unsigned</span> <span class="dt">long</span> <span class="op">*</span>image<span class="op">)</span></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> blockCountX <span class="op">=</span> <span class="op">(</span>width <span class="op">+</span> <span class="dv">3</span><span class="op">)</span> <span class="op">/</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> blockCountY <span class="op">=</span> <span class="op">(</span>height <span class="op">+</span> <span class="dv">3</span><span class="op">)</span> <span class="op">/</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> blockWidth <span class="op">=</span> <span class="op">(</span>width <span class="op">&lt;</span> <span class="dv">4</span><span class="op">)</span> <span class="op">?</span> width <span class="op">:</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> blockHeight <span class="op">=</span> <span class="op">(</span>height <span class="op">&lt;</span> <span class="dv">4</span><span class="op">)</span> <span class="op">?</span> height <span class="op">:</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">long</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> blockCountY<span class="op">;</span> j<span class="op">++)</span></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">long</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> blockCountX<span class="op">;</span> i<span class="op">++)</span> DecompressBlockDXT1<span class="op">(</span>i<span class="op">*</span><span class="dv">4</span><span class="op">,</span> j<span class="op">*</span><span class="dv">4</span><span class="op">,</span> width<span class="op">,</span> blockStorage <span class="op">+</span> i <span class="op">*</span> <span class="dv">8</span><span class="op">,</span> image<span class="op">);</span></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>        blockStorage <span class="op">+=</span> blockCountX <span class="op">*</span> <span class="dv">8</span><span class="op">;</span></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a><span class="co">// void DecompressBlockDXT5(): Decompresses one block of a DXT5 texture and stores the resulting pixels at the appropriate offset in &#39;image&#39;.</span></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a><span class="co">// unsigned long x:                     x-coordinate of the first pixel in the block.</span></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a><span class="co">// unsigned long y:                     y-coordinate of the first pixel in the block.</span></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a><span class="co">// unsigned long width:                 width of the texture being decompressed.</span></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a><span class="co">// unsigned long height:                height of the texture being decompressed.</span></span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a><span class="co">// const unsigned char *blockStorage:   pointer to the block to decompress.</span></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a><span class="co">// unsigned long *image:                pointer to image where the decompressed pixel data should be stored.</span></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> DecompressBlockDXT5<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">long</span> x<span class="op">,</span> <span class="dt">unsigned</span> <span class="dt">long</span> y<span class="op">,</span> <span class="dt">unsigned</span> <span class="dt">long</span> width<span class="op">,</span> <span class="at">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>blockStorage<span class="op">,</span> <span class="dt">unsigned</span> <span class="dt">long</span> <span class="op">*</span>image<span class="op">)</span></span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> alpha0 <span class="op">=</span> <span class="op">*</span><span class="kw">reinterpret_cast</span><span class="op">&lt;</span><span class="at">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*&gt;(</span>blockStorage<span class="op">);</span></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> alpha1 <span class="op">=</span> <span class="op">*</span><span class="kw">reinterpret_cast</span><span class="op">&lt;</span><span class="at">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*&gt;(</span>blockStorage <span class="op">+</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>bits <span class="op">=</span> blockStorage <span class="op">+</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> alphaCode1 <span class="op">=</span> bits<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">|</span> <span class="op">(</span>bits<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">&lt;&lt;</span> <span class="dv">8</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span>bits<span class="op">[</span><span class="dv">4</span><span class="op">]</span> <span class="op">&lt;&lt;</span> <span class="dv">16</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span>bits<span class="op">[</span><span class="dv">5</span><span class="op">]</span> <span class="op">&lt;&lt;</span> <span class="dv">24</span><span class="op">);</span></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">short</span> alphaCode2 <span class="op">=</span> bits<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">|</span> <span class="op">(</span>bits<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">&lt;&lt;</span> <span class="dv">8</span><span class="op">);</span></span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">short</span> color0 <span class="op">=</span> <span class="op">*</span><span class="kw">reinterpret_cast</span><span class="op">&lt;</span><span class="at">const</span> <span class="dt">unsigned</span> <span class="dt">short</span> <span class="op">*&gt;(</span>blockStorage <span class="op">+</span> <span class="dv">8</span><span class="op">);</span></span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">short</span> color1 <span class="op">=</span> <span class="op">*</span><span class="kw">reinterpret_cast</span><span class="op">&lt;</span><span class="at">const</span> <span class="dt">unsigned</span> <span class="dt">short</span> <span class="op">*&gt;(</span>blockStorage <span class="op">+</span> <span class="dv">10</span><span class="op">);</span>   </span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> temp<span class="op">;</span></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> <span class="op">(</span>color0 <span class="op">&gt;&gt;</span> <span class="dv">11</span><span class="op">)</span> <span class="op">*</span> <span class="dv">255</span> <span class="op">+</span> <span class="dv">16</span><span class="op">;</span></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> r0 <span class="op">=</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">)((</span>temp<span class="op">/</span><span class="dv">32</span> <span class="op">+</span> temp<span class="op">)/</span><span class="dv">32</span><span class="op">);</span></span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> <span class="op">((</span>color0 <span class="op">&amp;</span> <span class="bn">0x07E0</span><span class="op">)</span> <span class="op">&gt;&gt;</span> <span class="dv">5</span><span class="op">)</span> <span class="op">*</span> <span class="dv">255</span> <span class="op">+</span> <span class="dv">32</span><span class="op">;</span></span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> g0 <span class="op">=</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">)((</span>temp<span class="op">/</span><span class="dv">64</span> <span class="op">+</span> temp<span class="op">)/</span><span class="dv">64</span><span class="op">);</span></span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> <span class="op">(</span>color0 <span class="op">&amp;</span> <span class="bn">0x001F</span><span class="op">)</span> <span class="op">*</span> <span class="dv">255</span> <span class="op">+</span> <span class="dv">16</span><span class="op">;</span></span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> b0 <span class="op">=</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">)((</span>temp<span class="op">/</span><span class="dv">32</span> <span class="op">+</span> temp<span class="op">)/</span><span class="dv">32</span><span class="op">);</span></span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> <span class="op">(</span>color1 <span class="op">&gt;&gt;</span> <span class="dv">11</span><span class="op">)</span> <span class="op">*</span> <span class="dv">255</span> <span class="op">+</span> <span class="dv">16</span><span class="op">;</span></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> r1 <span class="op">=</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">)((</span>temp<span class="op">/</span><span class="dv">32</span> <span class="op">+</span> temp<span class="op">)/</span><span class="dv">32</span><span class="op">);</span></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> <span class="op">((</span>color1 <span class="op">&amp;</span> <span class="bn">0x07E0</span><span class="op">)</span> <span class="op">&gt;&gt;</span> <span class="dv">5</span><span class="op">)</span> <span class="op">*</span> <span class="dv">255</span> <span class="op">+</span> <span class="dv">32</span><span class="op">;</span></span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> g1 <span class="op">=</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">)((</span>temp<span class="op">/</span><span class="dv">64</span> <span class="op">+</span> temp<span class="op">)/</span><span class="dv">64</span><span class="op">);</span></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> <span class="op">(</span>color1 <span class="op">&amp;</span> <span class="bn">0x001F</span><span class="op">)</span> <span class="op">*</span> <span class="dv">255</span> <span class="op">+</span> <span class="dv">16</span><span class="op">;</span></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> b1 <span class="op">=</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">)((</span>temp<span class="op">/</span><span class="dv">32</span> <span class="op">+</span> temp<span class="op">)/</span><span class="dv">32</span><span class="op">);</span></span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> code <span class="op">=</span> <span class="op">*</span><span class="kw">reinterpret_cast</span><span class="op">&lt;</span><span class="at">const</span> <span class="dt">unsigned</span> <span class="dt">long</span> <span class="op">*&gt;(</span>blockStorage <span class="op">+</span> <span class="dv">12</span><span class="op">);</span></span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j<span class="op">=</span><span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> <span class="dv">4</span><span class="op">;</span> j<span class="op">++)</span></span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">4</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> alphaCodeIndex <span class="op">=</span> <span class="dv">3</span><span class="op">*(</span><span class="dv">4</span><span class="op">*</span>j<span class="op">+</span>i<span class="op">);</span></span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> alphaCode<span class="op">;</span></span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>alphaCodeIndex <span class="op">&lt;=</span> <span class="dv">12</span><span class="op">)</span></span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>                alphaCode <span class="op">=</span> <span class="op">(</span>alphaCode2 <span class="op">&gt;&gt;</span> alphaCodeIndex<span class="op">)</span> <span class="op">&amp;</span> <span class="bn">0x07</span><span class="op">;</span></span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>alphaCodeIndex <span class="op">==</span> <span class="dv">15</span><span class="op">)</span></span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>                alphaCode <span class="op">=</span> <span class="op">(</span>alphaCode2 <span class="op">&gt;&gt;</span> <span class="dv">15</span><span class="op">)</span> <span class="op">|</span> <span class="op">((</span>alphaCode1 <span class="op">&lt;&lt;</span> <span class="dv">1</span><span class="op">)</span> <span class="op">&amp;</span> <span class="bn">0x06</span><span class="op">);</span></span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="co">// alphaCodeIndex &gt;= 18 &amp;&amp; alphaCodeIndex &lt;= 45</span></span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>                alphaCode <span class="op">=</span> <span class="op">(</span>alphaCode1 <span class="op">&gt;&gt;</span> <span class="op">(</span>alphaCodeIndex <span class="op">-</span> <span class="dv">16</span><span class="op">))</span> <span class="op">&amp;</span> <span class="bn">0x07</span><span class="op">;</span></span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>            <span class="dt">unsigned</span> <span class="dt">char</span> finalAlpha<span class="op">;</span></span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>alphaCode <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>                finalAlpha <span class="op">=</span> alpha0<span class="op">;</span></span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>alphaCode <span class="op">==</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>                finalAlpha <span class="op">=</span> alpha1<span class="op">;</span></span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span></span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>alpha0 <span class="op">&gt;</span> alpha1<span class="op">)</span></span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>                    finalAlpha <span class="op">=</span> <span class="op">((</span><span class="dv">8</span><span class="op">-</span>alphaCode<span class="op">)*</span>alpha0 <span class="op">+</span> <span class="op">(</span>alphaCode<span class="op">-</span><span class="dv">1</span><span class="op">)*</span>alpha1<span class="op">)/</span><span class="dv">7</span><span class="op">;</span></span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span></span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="op">(</span>alphaCode <span class="op">==</span> <span class="dv">6</span><span class="op">)</span></span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>                        finalAlpha <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>alphaCode <span class="op">==</span> <span class="dv">7</span><span class="op">)</span></span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>                        finalAlpha <span class="op">=</span> <span class="dv">255</span><span class="op">;</span></span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span></span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>                        finalAlpha <span class="op">=</span> <span class="op">((</span><span class="dv">6</span><span class="op">-</span>alphaCode<span class="op">)*</span>alpha0 <span class="op">+</span> <span class="op">(</span>alphaCode<span class="op">-</span><span class="dv">1</span><span class="op">)*</span>alpha1<span class="op">)/</span><span class="dv">5</span><span class="op">;</span></span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>            <span class="dt">unsigned</span> <span class="dt">char</span> colorCode <span class="op">=</span> <span class="op">(</span>code <span class="op">&gt;&gt;</span> <span class="dv">2</span><span class="op">*(</span><span class="dv">4</span><span class="op">*</span>j<span class="op">+</span>i<span class="op">))</span> <span class="op">&amp;</span> <span class="bn">0x03</span><span class="op">;</span></span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>            <span class="dt">unsigned</span> <span class="dt">long</span> finalColor<span class="op">;</span></span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>            <span class="cf">switch</span> <span class="op">(</span>colorCode<span class="op">)</span></span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>                <span class="cf">case</span> <span class="dv">0</span><span class="op">:</span></span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>                    finalColor <span class="op">=</span> PackRGBA<span class="op">(</span>r0<span class="op">,</span> g0<span class="op">,</span> b0<span class="op">,</span> finalAlpha<span class="op">);</span></span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>                <span class="cf">case</span> <span class="dv">1</span><span class="op">:</span></span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>                    finalColor <span class="op">=</span> PackRGBA<span class="op">(</span>r1<span class="op">,</span> g1<span class="op">,</span> b1<span class="op">,</span> finalAlpha<span class="op">);</span></span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>                <span class="cf">case</span> <span class="dv">2</span><span class="op">:</span></span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>                    finalColor <span class="op">=</span> PackRGBA<span class="op">((</span><span class="dv">2</span><span class="op">*</span>r0<span class="op">+</span>r1<span class="op">)/</span><span class="dv">3</span><span class="op">,</span> <span class="op">(</span><span class="dv">2</span><span class="op">*</span>g0<span class="op">+</span>g1<span class="op">)/</span><span class="dv">3</span><span class="op">,</span> <span class="op">(</span><span class="dv">2</span><span class="op">*</span>b0<span class="op">+</span>b1<span class="op">)/</span><span class="dv">3</span><span class="op">,</span> finalAlpha<span class="op">);</span></span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>                <span class="cf">case</span> <span class="dv">3</span><span class="op">:</span></span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>                    finalColor <span class="op">=</span> PackRGBA<span class="op">((</span>r0<span class="op">+</span><span class="dv">2</span><span class="op">*</span>r1<span class="op">)/</span><span class="dv">3</span><span class="op">,</span> <span class="op">(</span>g0<span class="op">+</span><span class="dv">2</span><span class="op">*</span>g1<span class="op">)/</span><span class="dv">3</span><span class="op">,</span> <span class="op">(</span>b0<span class="op">+</span><span class="dv">2</span><span class="op">*</span>b1<span class="op">)/</span><span class="dv">3</span><span class="op">,</span> finalAlpha<span class="op">);</span></span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>x <span class="op">+</span> i <span class="op">&lt;</span> width<span class="op">)</span></span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a>                image<span class="op">[(</span>y <span class="op">+</span> j<span class="op">)*</span>width <span class="op">+</span> <span class="op">(</span>x <span class="op">+</span> i<span class="op">)]</span> <span class="op">=</span> finalColor<span class="op">;</span></span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a><span class="co">// void BlockDecompressImageDXT5(): Decompresses all the blocks of a DXT5 compressed texture and stores the resulting pixels in &#39;image&#39;.</span></span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a><span class="co">// unsigned long width:                 Texture width.</span></span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a><span class="co">// unsigned long height:                Texture height.</span></span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a><span class="co">// const unsigned char *blockStorage:   pointer to compressed DXT5 blocks.</span></span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a><span class="co">// unsigned long *image:                pointer to the image where the decompressed pixels will be stored.</span></span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> BlockDecompressImageDXT5<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">long</span> width<span class="op">,</span> <span class="dt">unsigned</span> <span class="dt">long</span> height<span class="op">,</span> <span class="at">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>blockStorage<span class="op">,</span> <span class="dt">unsigned</span> <span class="dt">long</span> <span class="op">*</span>image<span class="op">)</span></span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> blockCountX <span class="op">=</span> <span class="op">(</span>width <span class="op">+</span> <span class="dv">3</span><span class="op">)</span> <span class="op">/</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> blockCountY <span class="op">=</span> <span class="op">(</span>height <span class="op">+</span> <span class="dv">3</span><span class="op">)</span> <span class="op">/</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> blockWidth <span class="op">=</span> <span class="op">(</span>width <span class="op">&lt;</span> <span class="dv">4</span><span class="op">)</span> <span class="op">?</span> width <span class="op">:</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> blockHeight <span class="op">=</span> <span class="op">(</span>height <span class="op">&lt;</span> <span class="dv">4</span><span class="op">)</span> <span class="op">?</span> height <span class="op">:</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">long</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> blockCountY<span class="op">;</span> j<span class="op">++)</span></span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">long</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> blockCountX<span class="op">;</span> i<span class="op">++)</span> DecompressBlockDXT5<span class="op">(</span>i<span class="op">*</span><span class="dv">4</span><span class="op">,</span> j<span class="op">*</span><span class="dv">4</span><span class="op">,</span> width<span class="op">,</span> blockStorage <span class="op">+</span> i <span class="op">*</span> <span class="dv">16</span><span class="op">,</span> image<span class="op">);</span></span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a>        blockStorage <span class="op">+=</span> blockCountX <span class="op">*</span> <span class="dv">16</span><span class="op">;</span></span>
<span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
