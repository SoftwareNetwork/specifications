<h1 id="boost.mqtt5-a-c17-mqtt-client-based-on-boost.asio">Boost.MQTT5:
A C++17 MQTT client based on Boost.Asio</h1>
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 21%" />
<col style="width: 25%" />
<col style="width: 16%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>Branch</th>
<th>Linux Build</th>
<th>Windows Build</th>
<th>Coverage</th>
<th>Documentation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a
href="https://github.com/boostorg/mqtt5/tree/master"><code>master</code></a></td>
<td><a
href="https://github.com/boostorg/mqtt5/actions/workflows/ci-posix.yml"><img
src="https://github.com/boostorg/mqtt5/actions/workflows/ci-posix.yml/badge.svg?branch=master"
alt="build status" /></a></td>
<td><a
href="https://github.com/boostorg/mqtt5/actions/workflows/ci-windows.yml"><img
src="https://github.com/boostorg/mqtt5/actions/workflows/ci-windows.yml/badge.svg?branch=master"
alt="build status" /></a></td>
<td><a href="https://codecov.io/gh/boostorg/mqtt5/tree/master"><img
src="https://codecov.io/gh/boostorg/mqtt5/branch/master/graph/badge.svg"
alt="codecov" /></a></td>
<td><a
href="https://www.boost.org/doc/libs/master/libs/mqtt5/doc/html/index.html">documentation</a></td>
</tr>
<tr class="even">
<td><a
href="https://github.com/boostorg/mqtt5/tree/develop"><code>develop</code></a></td>
<td><a
href="https://github.com/boostorg/mqtt5/actions/workflows/ci-posix.yml"><img
src="https://github.com/boostorg/mqtt5/actions/workflows/ci-posix.yml/badge.svg?branch=develop"
alt="build status" /></a></td>
<td><a
href="https://github.com/boostorg/mqtt5/actions/workflows/ci-windows.yml"><img
src="https://github.com/boostorg/mqtt5/actions/workflows/ci-windows.yml/badge.svg?branch=develop"
alt="build status" /></a></td>
<td><a href="https://codecov.io/gh/boostorg/mqtt5/tree/develop"><img
src="https://codecov.io/gh/boostorg/mqtt5/branch/develop/graph/badge.svg"
alt="codecov" /></a></td>
<td><a
href="https://www.boost.org/doc/libs/develop/libs/mqtt5/doc/html/index.html">documentation</a></td>
</tr>
</tbody>
</table>
<p>Boost.MQTT5 is a professional, industrial-grade C++17 client built on
<a
href="https://www.boost.org/doc/libs/master/doc/html/boost_asio.html">Boost.Asio</a>.
This Client is designed for publishing or receiving messages from an
MQTT 5.0 compatible Broker. Boost.MQTT5 represents a comprehensive
implementation of the MQTT 5.0 protocol standard, offering full support
for publishing or receiving messages with QoS 0, 1, and 2.</p>
<h2 id="motivation">Motivation</h2>
<p>The <a href="https://mqtt.org/">MQTT</a> protocol is widely used for
communication in various real-world scenarios, primarily as a reliable
communication protocol for data transfer to and from IoT devices. While
the MQTT protocol is relatively straightforward, integrating it into an
application can be complex, primarily due to the challenging
implementation of message retransmission after a disconnect/reconnect
sequence. To address these challenges and simplify MQTT integration once
and for all, Boost.MQTT5 was designed with the following core objectives
in mind:</p>
<table>
<colgroup>
<col style="width: 43%" />
<col style="width: 56%" />
</colgroup>
<thead>
<tr class="header">
<th>Objective</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>“Plug and play” interface that abstracts away MQTT protocol
internals, low-level network events, message retransmission and other
complexities</td>
<td>Enables developers to publish or receive messages with just a single
line of code, significantly reducing the learning curve and development
time. Getting started requires basic MQTT knowledge, making the library
accessible to developers of all skill levels.</td>
</tr>
<tr class="even">
<td>Highly reliable and robust Client that handles network losses,
unreliable data transport, network latencies, and other unpredictable
events</td>
<td>The Client does not expose connect functions (nor asynchronous
connect functions); instead, network connectivity, MQTT handshake, and
message retransmission are automatically handled within the Client while
strictly adhering to the MQTT specification. This automation eliminates
the need for developers to write extensive and error-prone code to
handle these scenarios, allowing them to focus on the application’s core
functionality.</td>
</tr>
<tr class="odd">
<td>Complete adherence to the Boost.Asio’s universal asynchronous
model</td>
<td>The interfaces and implementation strategies are built upon the
foundations of Boost.Asio. This compatibility enables seamless
integration with any other library within the Boost.Asio ecosystem.</td>
</tr>
</tbody>
</table>
<h2 id="when-to-use">When to Use</h2>
<p>Boost.MQTT5 might be suitable for you if any of the following
statements is true:</p>
<ul>
<li>Your application uses Boost.Asio and requires integrating an MQTT
Client.</li>
<li>You require asynchronous access to an MQTT Broker.</li>
<li>You are developing a higher-level component that requires a
connection to an MQTT Broker.</li>
<li>You require a dependable and resilient MQTT Client to manage all
network-related issues automatically.</li>
</ul>
<p>It may not be suitable for you if: - You solely require synchronous
access to an MQTT Broker. - The MQTT Broker you connect to does not
support the MQTT 5 version.</p>
<h2 id="features">Features</h2>
<p>Boost.MQTT5 is a library designed with the core belief that users
should focus solely on their application logic, not the network
complexities. The library attempts to embody this belief with a range of
key features designed to elevate the development experience:</p>
<table>
<colgroup>
<col style="width: 38%" />
<col style="width: 61%" />
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Complete TCP, TLS/SSL, and WebSocket support</strong></td>
<td>The MQTT protocol requires an underlying network protocol that
provides ordered, lossless, bi-directional connection (stream). Users
can customize this stream through a template parameter. The Boost.MQTT5
library has been tested with the most used transport protocols: TCP/IP
using <code>boost::asio::ip::tcp::socket</code>, TLS/SSL using
<code>boost::asio::ssl::stream</code>, WebSocket/TCP and WebSocket/TLS
using <code>boost::beast::websocket::stream</code>).</td>
</tr>
<tr class="even">
<td><strong>Automatic reconnect and retry mechanism</strong></td>
<td>Automatically handles connection loss, backoffs, reconnections, and
message transmissions. Automating these processes enables users to focus
entirely on the application’s functionality. See <a
href="https://www.boost.org/doc/libs/master/libs/mqtt5/doc/html/mqtt5/auto_reconnect.html">Built-in
Auto-Reconnect and Retry Mechanism</a>.</td>
</tr>
<tr class="odd">
<td><strong>Prioritised efficiency</strong></td>
<td>Utilises network and memory resources as efficiently as
possible.</td>
</tr>
<tr class="even">
<td><strong>Minimal memory footprint</strong></td>
<td>Ensures optimal performance in resource-constrained environments
typical of IoT devices.</td>
</tr>
<tr class="odd">
<td><strong>Completion token</strong></td>
<td>All asynchronous functions are implemented using Boost.Asio’s
universal asynchronous model and support CompletionToken. This allows
versatile usage with callbacks, coroutines, and futures.</td>
</tr>
<tr class="even">
<td><strong>Custom allocators</strong></td>
<td>Support for custom allocators allows extra flexibility and control
over the memory resources. Boost.MQTT5 will use allocators associated
with handlers from asynchronous functions to create instances of objects
needed in the library implementation.</td>
</tr>
<tr class="odd">
<td><strong>Per-operation cancellation</strong></td>
<td>All asynchronous operations support individual, targeted
cancellation as per Asio’s <a
href="https://www.boost.org/doc/libs/1_82_0/doc/html/boost_asio/overview/core/cancellation.html">Per-Operation
Cancellation</a>. This enables all asynchronous functions to be used in
<a
href="https://www.boost.org/doc/libs/1_86_0/doc/html/boost_asio/overview/composition/parallel_group.html">Parallel
Operations</a>, which is especially beneficial for executing operations
that require a timeout mechanism.</td>
</tr>
<tr class="even">
<td><strong>Full implementation of MQTT 5.0 specification</strong></td>
<td>Ensures full compatibility with <a
href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/mqtt-v5.0.html">MQTT
5.0 standard</a>. This latest version introduces essential features that
enhance system robustness, including advanced error-handling mechanisms,
session and message expiry, and other improvements designed to support
modern IoT use cases.</td>
</tr>
<tr class="odd">
<td><strong>Support for QoS 0, QoS 1, and QoS 2</strong></td>
<td>Fully implements all quality-of-service levels defined by the MQTT
protocol to match different reliability needs in message delivery.</td>
</tr>
<tr class="even">
<td><strong>Custom authentication</strong></td>
<td>Defines an interface for your custom authenticators to perform <a
href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901256">Enhanced
Authentication</a>. In addition to username/password authentication,
this customization point enables the implementation of any
authentication mechanism supported by the SASL protocol, offering
flexibility for advanced security requirements.</td>
</tr>
<tr class="odd">
<td><strong>High availability</strong></td>
<td>Supports listing multiple Brokers within the same cluster to which
the Client can connect. In the event of a connection failure with one
Broker, the Client switches to the next in the list.</td>
</tr>
<tr class="even">
<td><strong>Offline buffering</strong></td>
<td>Automatically buffers all requests made while offline, ensuring they
are sent when the connection is re-established. This allows users to
call any asynchronous function freely, regardless of current connection
status.</td>
</tr>
</tbody>
</table>
<h2 id="getting-started">Getting Started</h2>
<p>Boost.MQTT5 is a header-only library. To use Boost.MQTT5 it requires
the following: - <strong>C++17 capable compiler</strong> - <strong>Boost
1.82 or later</strong>. In addition to Asio, we use other header-only
libraries. - <strong>OpenSSL</strong>. If you require an SSL connection
by using <a
href="https://www.boost.org/doc/libs/1_82_0/doc/html/boost_asio/reference/ssl__stream.html">boost::asio::ssl::stream</a>.</p>
<p>Boost.MQTT5 has been tested with the following compilers: - clang
12.0 - 18.0 (Linux) - GCC 9 - 14 (Linux) - MSVC 14.37 - Visual Studio
2022 (Windows)</p>
<h2 id="using-the-library">Using the Library</h2>
<ol type="1">
<li>Download <a href="https://www.boost.org/users/download/">Boost</a>,
and add it to your include path.</li>
<li>If you use SSL, download <a
href="https://www.openssl.org/">OpenSSL</a>, link the library and add it
to your include path.</li>
<li>Add Boost.MQTT5’s <code>include</code> folder to your include
path.</li>
</ol>
<p>You can compile the example below with the following command line on
Linux:</p>
<pre><code>$ clang++ -std=c++17 &lt;source-cpp-file&gt; -o example -I&lt;path-to-boost&gt; -Iinclude -pthread</code></pre>
<h2 id="example">Example</h2>
<p>The following example illustrates a scenario of configuring a Client
and publishing a “Hello World!” Application Message with
<code>QoS</code> 0.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;boost/mqtt5/mqtt_client.hpp&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;boost/mqtt5/types.hpp&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;boost/asio/io_context.hpp&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;boost/asio/detached.hpp&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;boost/asio/ip/tcp.hpp&gt;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">boost::</span>asio::io_context ioc<span class="op">;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">boost::</span>mqtt5::mqtt_client<span class="op">&lt;</span><span class="ex">boost::</span>asio::ip::tcp::socket<span class="op">&gt;</span> c<span class="op">(</span>ioc<span class="op">);</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    c<span class="op">.</span>brokers<span class="op">(</span><span class="st">&quot;&lt;your-mqtt-broker&gt;&quot;</span><span class="op">,</span> <span class="dv">1883</span><span class="op">)</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>credentials<span class="op">(</span><span class="st">&quot;&lt;your-client-id&gt;&quot;</span><span class="op">,</span> <span class="st">&quot;&lt;client-username&gt;&quot;</span><span class="op">,</span> <span class="st">&quot;&lt;client-pwd&gt;&quot;</span><span class="op">)</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>async_run<span class="op">(</span><span class="ex">boost::</span>asio::detached<span class="op">);</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    c<span class="op">.</span>async_publish<span class="op">&lt;</span><span class="ex">boost::</span>mqtt5::qos_e::at_most_once<span class="op">&gt;(</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&lt;topic&gt;&quot;</span><span class="op">,</span> <span class="st">&quot;Hello world!&quot;</span><span class="op">,</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        <span class="ex">boost::</span>mqtt5::retain_e::no<span class="op">,</span> <span class="ex">boost::</span>mqtt5::publish_props <span class="op">{},</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">[&amp;</span>c<span class="op">](</span><span class="ex">boost::</span>mqtt5::error_code ec<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> ec<span class="op">.</span>message<span class="op">()</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>            c<span class="op">.</span>async_disconnect<span class="op">(</span><span class="ex">boost::</span>asio::detached<span class="op">);</span> <span class="co">// disconnect and close the Client</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    ioc<span class="op">.</span>run<span class="op">();</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>To see more examples, visit <a
href="https://github.com/boostorg/mqtt5/tree/master/example">Examples</a>.</p>
<h2 id="contributing">Contributing</h2>
<p>When contributing to this repository, please first discuss the change
you wish to make via issue, email, or any other method with the owners
of this repository before making a change.</p>
<p>You may merge a Pull Request once you have the sign-off from other
developers, or you may request the reviewer to merge it for you.</p>
<h2 id="credits">Credits</h2>
<p>Maintained and authored by <a
href="https://www.mireo.com">Mireo</a>.</p>
<p align="center">
<a href="https://www.mireo.com"><img height="200" alt="Mireo" src="https://www.mireo.com/img/assets/mireo-logo.svg"></img></a>
</p>
